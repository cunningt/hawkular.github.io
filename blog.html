<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Hawkular</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- css -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/asciidoctor.css" rel="stylesheet">
    <link href="css/base.css" rel="stylesheet">
    <link href="css/tabzilla.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <link href="css/prettify.css" rel="stylesheet">
    <link href="css/ekko-lightbox.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
    <script src="js/moment.min.js"></script>
    <script src="js/jquery-1.11.2.min.js"></script>

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="alternate" href="feed.xml" title="Hawkular Blog - RSS" type="application/rss+xml">

  </head>
  <body onload="prettyPrint()" data-spy="scroll" data-offset="80" data-target="#toc">
    <div id="wrap">
      <div class="dropup">
        <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
        <script>
            window.addEventListener('load', function() {
                 renderTabzilla("Hawkular", "https://hawkular.github.io", true );
            }, false);
        </script>
      </div>

    	<!-- Fixed navbar -->
        <nav class="navbar navbar-fixed-top" role="navigation">
          <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button class="navbar-toggle collapsed" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="">Home</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav">
                <li><a href="overview/">Overview</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li class="dropdown">
                  <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                    Hawkular Services<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li class="menu-item dropdown dropdown-submenu">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation</a>
                      <ul class="dropdown-menu">
                        <li class="menu-item ">
                          <a href="hawkular-services/docs/quickstart-guide/">Quickstart</a>
                        </li>
                        <li class="menu-item ">
                          <a href="hawkular-services/docs/installation-guide/">Installation Guide</a>
                        </li>
                        <li class="menu-item ">
                          <a href="hawkular-services/docs/user-guide/">User Guide</a>
                        </li>
                        <li class="menu-item dropdown dropdown-submenu">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">REST API</a>
                          <ul class="dropdown-menu">
                            <li class="menu-item ">
                              <a href="docs/rest/rest-alerts.html">Alerting</a>
                            </li>
                            <li class="menu-item ">
                              <a href="docs/rest/rest-inventory.html">Inventory</a>
                            </li>
                            <li class="menu-item ">
                              <a href="docs/rest/rest-metrics.html">Metrics</a>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a href="https://github.com/hawkular/hawkular-services/releases">Download</a>
                    </li>
                  </ul>
                </li>
                <li class="dropdown">
                  <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                    Hawkular APM<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li>
                      <a href="https://hawkular.gitbooks.io/hawkular-apm-user-guide/content/">Documentation</a>
                    </li>
                    <li>
                      <a href="https://github.com/hawkular/hawkular-apm/releases/">Download</a>
                    </li>
                  </ul>
                </li>
                <li class="dropdown">
                  <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                    Hawkular Metrics<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                  <li class="menu-item dropdown dropdown-submenu">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation</a>
                      <ul class="dropdown-menu">
                        <li class="menu-item ">
                          <a href="hawkular-metrics/docs/user-guide/">User Guide</a>
                        </li>
                        <li class="menu-item ">
                          <a href="docs/rest/rest-metrics.html">Metrics REST API</a>
                        </li>
                        <li class="menu-item ">
                          <a href="docs/rest/rest-alerts.html">Alerting REST API</a>
                        </li>
                      </ul>
                  </li>
                    <li>
                      <a href="https://github.com/hawkular/hawkular-metrics/releases/">Download</a>
                    </li>
                  </ul>
                </li>
                <li><a href="hawkular-clients/">Hawkular Clients</a></li>
                <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                  Community
                  <span class="caret"></span>
                </a>
                <ul class="dropdown-menu" role="menu">
                  <li>
                    <a href="community/docs/getting-involved/">Getting Involved</a>
                  </li>
                  <li class="menu-item ">
                    <a href="community/docs/developer-guide/">Developer Guide</a>
                  </li>
                  <li class="menu-item dropdown dropdown-submenu">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Labs</a>
                      <ul class="dropdown-menu">
                        <li class="menu-item ">
                          <a href="community/labs/datamining/">Datamining</a>
                        </li>
                        <li class="menu-item ">
                          <a href="https://github.com/pilhuhn/hawkfx">HawkFX</a>
                        </li>
                        <li class="menu-item ">
                          <a href="hawkular-clients/android-client/">Android client</a>
                        </li>
                      </ul>
                  </li>
                  <li>
                    <a href="https://github.com/hawkular">GitHub Repositories</a>
                  <li>
                    <a href="https://travis-ci.org/hawkular">CI Builds</a>
                  </li>
                </ul></li>
              </ul>
            </div>
          </div>
        </nav>


<section class="main-banner blog-mainbanner">
    <div class="container">
        <h1>Hawkular Blog</h1>
    </div>
</section>


<div class="blog-container">
            <a href="blog/2016/10/25/hawkular-metrics-0.21.0.Final-released.html"><h1>Hawkular Metrics 0.21.0 - Release</h1></a>
            <p>25 October 2016, by Stefan Negrea</p>
            <p><p>I am happy to announce release 0.21.0 of Hawkular Metrics.This release is anchored by performance enhancements and general fixes.</p><p>Here is a list of major changes:</p>
<ul>
  <li><p>Cassandra</p>
  <ul>
    <li><strong>Cassandra 3.0.9 is now the supported version of Cassandra.</strong></li>
    <li>Note: this is a rollback from previously supported version of 3.7 due to Cassandra community recommendations for stability and production deployment. Cassandra 3.7 or 3.9 are still compatible but development and testing now use 3.0.9 release.</li>
  </ul></li>
  <li><p>Compression</p>
  <ul>
    <li>Fixed an issue that allowed duplicate instances of the compression job to get scheduled on server restart (<a href="https://issues.jboss.org/browse/HWKMETRICS-492">HWKMETRICS-492</a>)</li>
    <li>Improved the fault tolerance of the compression job (<a href="https://issues.jboss.org/browse/HWKMETRICS-494">HWKMETRICS-494</a>)</li>
    <li>Improved the performance of the merge process for reading compressed data (<a href="https://issues.jboss.org/browse/HWKMETRICS-488">HWKMETRICS-488</a>)</li>
    <li>Fixed wrong ordering when fetching compressed and uncompressed data (<a href="https://issues.jboss.org/browse/HWKMETRICS-506">HWKMETRICS-506</a>)</li>
    <li>Compression job provides back pressure (<a href="https://issues.jboss.org/browse/HWKMETRICS-500">HWKMETRICS-500</a>)</li>
    <li>The job scheduler now handles failure scenarios (<a href="https://issues.jboss.org/browse/HWKMETRICS-505">HWKMETRICS-505</a>)</li>
  </ul></li>
  <li><p>Cassandra Schema</p>
  <ul>
    <li>Fixed an issue where the server can fail to start due to Cassalog being in inconsistent state (<a href="https://issues.jboss.org/browse/HWKMETRICS-495">HWKMETRICS-495</a>)</li>
    <li><code>gc_grace_second</code> is set to zero for single node clusters (<a href="https://issues.jboss.org/browse/HWKMETRICS-381">HWKMETRICS-381</a>)</li>
  </ul></li>
  <li><p>API Updates</p>
  <ul>
    <li>Inserting data points has server side retries to increase the fault tolerance for simple error scenarios (<a href="https://issues.jboss.org/browse/HWKMETRICS-510">HWKMETRICS-510</a>)</li>
    <li><code>fromEarliest</code> parameter is now supported in all query endpoints (<a href="https://issues.jboss.org/browse/HWKMETRICS-445">HWKMETRICS-445</a>)</li>
    <li>Non-existant tag queries are now supported via <code>!tag:*</code> format; example: <code>!partition:*</code> (<a href="https://issues.jboss.org/browse/HWKMETRICS-480">HWKMETRICS-480</a>)</li>
  </ul></li>
  <li><p>Configuration</p>
  <ul>
    <li>The configuration options did not have a consistent naming scheme. <code>hawkular-metrics</code>, <code>hawkular.metrics</code>, and <code>hawkular</code> prefixes were used along no prefixes at all.</li>
    <li>In this release the naming schema has been standardized to <code>hawkular.metrics.*</code> for metrics specific configuration and <code>hawkular.*</code> for general configuration.</li>
    <li>Here is list of all configuration options currently available: <a href="https://github.com/hawkular/hawkular-metrics/blob/release/0.21.0/api/metrics-api-util/src/main/java/org/hawkular/metrics/api/jaxrs/config/ConfigurationKey.java#L29">ConfigurationKey</a></li>
    <li>For more details: <a href="https://issues.jboss.org/browse/HWKMETRICS-508">HWKMETRICS-508</a></li>
  </ul></li>
</ul><p><strong>Hawkular Alerting - included</strong></p>
<ul>
  <li>Version <a href="https://issues.jboss.org/projects/HWKALERTS/versions/12331985">1.3.0</a></li>
  <li>Project details and repository: <a href="https://github.com/hawkular/hawkular-alerts">Github</a></li>
  <li>Documentation: <a href="http://www.hawkular.org/docs/rest/rest-alerts.html">REST API Documentation</a>, <a href="https://github.com/hawkular/hawkular-alerts/tree/master/examples">Examples</a>,<br/><a href="http://www.hawkular.org/community/docs/developer-guide/alerts.html">Developer Guide</a></li>
</ul><p><strong>Hawkular Metrics Clients</strong></p>
<ul>
  <li>Python: <a href="https://github.com/hawkular/hawkular-client-python">https://github.com/hawkular/hawkular-client-python</a></li>
  <li>Go: <a href="https://github.com/hawkular/hawkular-client-go">https://github.com/hawkular/hawkular-client-go</a></li>
  <li>Ruby: <a href="https://github.com/hawkular/hawkular-client-ruby">https://github.com/hawkular/hawkular-client-ruby</a></li>
  <li>Java: <a href="https://github.com/hawkular/hawkular-client-java">https://github.com/hawkular/hawkular-client-java</a></li>
</ul><h3>Release Links</h3>
<ul>
  <li>Github Release: <a href="https://github.com/hawkular/hawkular-metrics/releases/tag/0.21.0">https://github.com/hawkular/hawkular-metrics/releases/tag/0.21.0</a></li>
  <li>JBoss Nexus Maven artifacts: <a href="http://origin-repository.jboss.org/nexus/content/repositories/public/org/hawkular/metrics/">http://origin-repository.jboss.org/nexus/content/repositories/public/org/hawkular/metrics/</a></li>
  <li>Jira release tracker: <a href="https://issues.jboss.org/projects/HWKMETRICS/versions/12331718">https://issues.jboss.org/projects/HWKMETRICS/versions/12331718</a></li>
</ul><p>A big "Thank you" goes to John Sanda, Matt Wringe, Michael Burman, Joel Takvorian, Jay Shaughnessy, Lucas Ponce, and Heiko Rupp for their project contributions.</p></p>
            <br />
            <hr /><br />
            <br />
            <a href="blog/2016/10/24/hawkfx-alerts.html"><h1>Define Alert Triggers via HawkFX</h1></a>
            <p>24 October 2016, by Heiko W. Rupp</p>
            <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>HawkFX is an explorer for Hawkular. It is a pet project of mine and <a href="https://github.com/pilhuhn/hawkfx">hosted on
Github</a>. It now has the ability to define alerting triggers.</p>
</div>
<div class="paragraph">
<p>Hawkular-services and now also Hawkular-Metrics standalone have the ability to fire alerts when certain conditions
are met. To define those conditions, one creates a <em>trigger</em> via
the <a href="http://www.hawkular.org/docs/rest/rest-alerts.html">Hawkular-Alerts api</a>. The alerting team has also written a
<a href="http://www.hawkular.org/community/docs/developer-guide/alerts.html">developer guide</a> that explains the concepts and
terms behind Hawkular-Alerts.</p>
</div>
<div class="paragraph">
<p>HawkFX now has the ability to directly insert new triggers. For this purpose I have created a
<a href="http://pilhuhn.blogspot.de/2016/10/a-dsl-for-alert-trigger-definitions-in.html">DSL</a> to allow to define triggers
in a more 'natural language'. More on this below.</p>
</div>
<div id="img-main" class="imageblock">
<div class="content">
<img src="/img/blog/2016/hawkfx-trigger-menu.png" alt="HawkFX trigger context menu" width="300">
</div>
<div class="title">Figure 1. Context menu</div>
</div>
<div class="paragraph">
<p>When you right-click on a metric in the HawkFX list of metrics, there is now a new context menu item 'New trigger',
that leads you to the insert screen, where you can insert the definition. This will contain a canned definition
to start with.</p>
</div>
<div id="img-main" class="imageblock">
<div class="content">
<img src="/img/blog/2016/hawkfx-trigger-insert-box.png" alt="HawkFX trigger insert" width="600">
</div>
<div class="title">Figure 2. Alert trigger insert screen</div>
</div>
<div class="paragraph">
<p>When you are done writing the definition, you can click on the <em>parse</em> button at the bottom to check the definition.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples">Examples</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Simple threshold trigger for gauges</div>
<div class="content">
<pre>define trigger "MyTrigger"
 ( threshold "myvalue" &gt; 3 )</pre>
</div>
</div>
<div class="listingblock">
<div class="title">and for counters</div>
<div class="content">
<pre>define trigger "MyTrigger"
( threshold counter "myvalue" &gt; 3 )</pre>
</div>
</div>
<div class="paragraph">
<p>You can see from the previous two examples that gauges are the default for <em>threshold</em> triggers, so you can omit that
 keyword.</p>
</div>
<div class="listingblock">
<div class="title">Trigger for availability, with high severity that is initially disabled</div>
<div class="content">
<pre>define trigger "MyTrigger"
  disabled
  severity HIGH
  ( availability "mymetric" is DOWN )</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Trigger that fires when two conditions are true</div>
<div class="content">
<pre>define trigger "MyTrigger"
  AND(
    ( threshold counter "mycount" &lt; 5 )
    ( string "mymetric" CO "ERROR" )
  )</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Trigger that disables itself after firing</div>
<div class="content">
<pre>define trigger "MyTrigger"
 ( threshold "myvalue" &gt; 3 )
 auto-disable</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_state_of_the_dsl">State of the DSL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The DSL is in flux and will be augmented and refined. So far it only contains a basic set of instructions.</p>
</div>
<div class="paragraph">
<p>The DSL tries to make life easy by trying to set sensible defaults (e.g. a trigger is enabled by default - you have
to provide the <em>disable</em> command explicitly).</p>
</div>
<div class="paragraph">
<p>If you are interested in the grammar behind the DSL, visit the
<a href="https://github.com/pilhuhn/hawkfx/blob/master/lib/alert_trigger.treetop">definition file</a>.
For examples about supported usage, you can have a look at
the <a href="https://github.com/pilhuhn/hawkfx/blob/master/spec/alert_trigger_parser_spec.rb">spec</a>.</p>
</div>
<div class="paragraph">
<p>I hope to be able to extend the DSL going forward and get it into a state where it is useful for people.
At least it makes it easy for me to get triggers defined when working on Hawkular.</p>
</div>
<div class="paragraph">
<p>Going forward it could also be possible to offer DSLs that mimic if-this-then-that or Zabbix rules, so that users of
those systems can (re-)use their existing rules.</p>
</div>
<div class="paragraph">
<p>As <a href="http://hawkular.org/blog/2016/07/13/hawkfx.html">written before</a>, HawkFX is a Pet project of mine and comes with no
support.</p>
</div>
</div>
</div></p>
            <br />
            <hr /><br />
            <br />
            <a href="blog/2016/10/24/hawkular-metrics-openshift-and-grafana.html"><h1>Monitoring Microservices with OpenShift, Hawkular Metrics and Grafana</h1></a>
            <p>24 October 2016, by Joel Takvorian</p>
            <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift, Hawkular Metrics and Grafana are three great tools that we can combine to build a powerful monitoring system for microservices.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Grafana is the visualization layer that enables building custom and dynamic dashboards.</p>
</li>
<li>
<p>Hawkular Metrics is the robust and flexible layer that is used for metrics storage and querying.</p>
</li>
<li>
<p>And OpenShift 3 is the new container platform from Red Hat built on top of Docker and Kubernetes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s see how to make them work together and visualize our microservices metrics in Grafana.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_preparing_openshift">Preparing OpenShift</h3>
<div class="paragraph">
<p>I assume you already have access to a running OpenShift Origin (1.0.8 or later), but if you don&#8217;t, you can <a href="https://github.com/openshift/origin">follow the installation steps</a>. Or if you&#8217;re a lazy boy/girl like me, you can use <a href="https://github.com/jimmidyson/minishift">MiniShift</a> to get it running very quickly. Just make sure you assign enough memory and CPU resources to the VM; I could get everything running fine with 2 cores and 4GB, of course that will depend on your hardware.</p>
</div>
<div class="paragraph">
<p>Then follow the <a href="https://github.com/openshift/origin-metrics">origin-metrics installation steps</a> to deploy Hawkular Metrics in OpenShift.</p>
</div>
<div class="paragraph">
<p>Note that Grafana will not work on an insecure SSL connection to Hawkular. So you will have to provide your own certificates when creating the secret:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">$ oc secrets new metrics-deployer hawkular-metrics.pem=/path/to/hm.pem \
hawkular-metrics-ca.cert=/path/to/hm-ca.cert -n openshift-infra</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_a_microservice">Deploying a Microservice</h3>
<div class="paragraph">
<p>You will need to deploy some application in OpenShift. For this article I&#8217;ll use some parts of the <a href="https://htmlpreview.github.io/?https://github.com/redhat-helloworld-msa/helloworld-msa/blob/master/readme.html#_deploy_aloha_vert_x_microservice">Red Hat Helloworld MSA</a> to deploy "Aloha", and later "Bonjour".</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">$ oc login -u ... -p ...
# The project name you choose here matters, because it will be the tenant ID in Hawkular
$ oc new-project test
$ git clone https://github.com/redhat-helloworld-msa/aloha
$ cd aloha/
$ oc new-build --binary --name=aloha -l app=aloha
$ mvn package; oc start-build aloha --from-dir=. --follow
$ oc new-app aloha -l app=aloha,hystrix.enabled=true
$ oc expose service aloha</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can open the OpenShift web console to see when Aloha is correctly deployed. And scale it up to 2 pods. The web console should show something like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-aloha-openshift.png" alt="Aloha in OpenShift">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setup_hawkular_datasource_in_grafana">Setup Hawkular Datasource in Grafana</h3>
<div class="paragraph">
<p>So now, let&#8217;s have a look at Grafana. For this article I&#8217;ve installed a recent version (3.1.1) and the <a href="https://github.com/hawkular/hawkular-grafana-datasource">Hawkular Datasource plugin</a> (1.0.2).</p>
</div>
<div class="paragraph">
<p>In Grafana, to configure the Hawkular Datasource, set the URL of the Metrics service in OpenShift, ending with <em>/hawkular/metrics</em>. You should have something similar to <em><a href="https://metrics.192.168.42.63.xip.io/hawkular/metrics" class="bare">https://metrics.192.168.42.63.xip.io/hawkular/metrics</a></em>. Access mode must be <em>Proxy</em>. The tenant must be the name of the project in OpenShift where we&#8217;ve created our sample application; so for my example here, it&#8217;s just "test". And finally, put the bearer token for the OpenShift API access. To generate a token, you can navigate to <em>/oauth/token/request</em> from your OpenShift base path (something like <em><a href="https://192.168.42.63:8443/oauth/token/request" class="bare">https://192.168.42.63:8443/oauth/token/request</a></em>).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-grafana-hawkular-datasource.png" alt="Hawkular Datasource configuration">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_the_dashboard">Create the Dashboard</h3>
<div class="paragraph">
<p>Now we can create a new dashboard. And a template variable, which will be the cornerstone of our dynamic dashboards.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-grafana-templating.png" alt="Open templating">
</div>
</div>
<div class="paragraph">
<p><em>Open dashboard templating screen</em></p>
</div>
<div class="paragraph">
<p>Create a variable named <em>app</em>, select your Hawkular datasource and type in query: <em>tags/container_name:*</em></p>
</div>
<div class="paragraph">
<p>As you can guess, it will search all known values of the tag <em>container_name</em>. Once you&#8217;ve typed the query, you should see your application names displayed at the bottom of the page.</p>
</div>
<div class="paragraph">
<p>Ticking <em>Multi-value</em> and <em>Include All option</em> is recommended as it will enable better filtering.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-grafana-edit-variable.png" alt="Editing variables">
</div>
</div>
<div class="paragraph">
<p>With this single variable, you will already be able to build a nice dynamic dashboard.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you want to see the list of available tags created in OpenShift, you can fetch the metrics definitions with the following command: <code><code>curl -X GET <a href="https://yourserver/hawkular/metrics/metrics" class="bare">https://yourserver/hawkular/metrics/metrics</a> -H "Content-Type: application/json" -H "Hawkular-Tenant: your-tenant" -H "Authorization: Bearer your-bearer-token"</code></code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, time to see nice charts! In the first row, we create a new panel of type Graph. In General tab, set "Memory usage" as the graph title. In Metrics tab, select your Hawkular datasource. Create a series of type Gauge, searching by tag, and give the following tags:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>container_name</em>: <em>$app</em></p>
</li>
<li>
<p><em>descriptor_name</em>: <em>memory/usage</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These tagged metrics are provided to Hawkular by OpenShift.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-grafana-memory-usage.png" alt="Memory usage">
</div>
</div>
<div class="paragraph">
<p>From now on, you can see the memory usage by pod instance and for all your applications. There are 2 series because we scaled the service to 2 pods earlier.</p>
</div>
<div class="paragraph">
<p>You can edit the Graph Axes to set Y-Unit "Data &gt; Bytes" and Y-min 0. Note that you can also show stacked values from the Display tab. This is useful when you want to see the total amount of memory.</p>
</div>
<div class="paragraph">
<p>Next, we will show some aggregated stats. But before that, go back editing the Graph panel and, in the General tab, set span to 6.</p>
</div>
<div class="paragraph">
<p>From the Row menu create a new <em>Singlestat</em> panel. Name it <em>"Average, all pods"</em>, span 2, height 100px. In the Metrics tab, select your Hawkular datasource. <em>Search by tags</em> using the same tags as before: <em>container_name</em>: <em>$app</em>, <em>descriptor_name</em>: <em>memory/usage</em>.</p>
</div>
<div class="paragraph">
<p>As you can see, there&#8217;s some new options when querying from a Singlestat panel: Multiple series aggregation and Time aggregation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-grafana-singlestat.png" alt="Singletat query">
</div>
</div>
<div class="paragraph">
<p>When a standard query by tag is submitted to Hawkular Metrics, the response may contain several series of data points, depending on the matching tags. Since we want here to get a single number, we will ask the plugin to perform a two-steps aggregation: a "vertical" aggregation that merges all series into a single one, and an "horizontal" aggregation that extracts a single stat from a time-series.</p>
</div>
<div class="paragraph">
<p>As you can see, when the <em>Multiple series aggregation</em> is left to <em>None</em>, Grafana reports a <em>Multiple Series Error</em>. This is because the Singlestat panel doesn&#8217;t know how to merge multiple series, so let&#8217;s ask the Hawkular plugin to do it. Select <em>Sum</em> instead of <em>None</em>, and keep <em>Average</em> for the time aggregation.</p>
</div>
<div class="paragraph">
<p>Now switch to the Options tab and change Unit to "Data &gt; bytes". Here, you can define thresholds to highlight high memory levels.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Usually, Grafana&#8217;s Singlestat panel performs time aggregation by itself, through the <em>value</em> field on the <em>Big value</em> row. But since the Hawkular plugin does it on its own, setting whatever value in this field won&#8217;t have any effect.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-grafana-one-singlestat.png" alt="A singlestat">
</div>
</div>
<div class="paragraph">
<p>To finalize this dashboard setup for an application, click on the Singlestat panel title and duplicate 5 times. Edit each of the duplicates with the following names and queries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Max, all pods": set <em>Time aggregation</em> to <em>Max</em></p>
</li>
<li>
<p>"Live, all pods": set <em>Time aggregation</em> to <em>Live</em></p>
</li>
<li>
<p>"Average per pod": set <em>Multiple series aggregation</em> to <em>Average</em></p>
</li>
<li>
<p>"Max per pod": set <em>Multiple series aggregation</em> to <em>Average</em> and <em>Time aggregation</em> to <em>Max</em></p>
</li>
<li>
<p>"Live per pod": set <em>Multiple series aggregation</em> to <em>Average</em> and <em>Time aggregation</em> to <em>Live</em></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-grafana-6-singlestats.png" alt="6 singlestats">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_another_application">Adding Another Application</h3>
<div class="paragraph">
<p>Now we have a pretty nice dashboard for tracking memory usage on an application. Let&#8217;s see what happens if we add a new application in OpenShift, under the same project.</p>
</div>
<div class="paragraph">
<p>This time I&#8217;ll use <em><a href="https://htmlpreview.github.io/?https://github.com/redhat-helloworld-msa/helloworld-msa/blob/master/readme.html#_deploy_bonjour_nodejs_microservice">Bonjour from Helloworld MSA</a></em>, which is a Node.js microservice. After adding it to OpenShift, and again scaling it to 2 pods, see how it looks like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-grafana-apps-merged.png" alt="Merged applications">
</div>
</div>
<div class="paragraph">
<p>Hmm, interesting. Our panels show new series: two for the <em>Bonjour</em> microservice and one <em>docker-build</em>. The later is caused by the build I triggered when I created <em>Bonjour</em>. The sequence of the events is quite obvious when looking at the graphs. We don&#8217;t necessarily want to monitor that, but it&#8217;s nice to see how far we can go with Hawkular and OpenShift. Anyway, we can filter it out using the top combo box <em>Application</em>.</p>
</div>
<div class="paragraph">
<p>But still, this is probably not what we would expect. What happens here is that the <em>$app</em> variable we set up in queries is resolved into as many <em>container_name</em> as there are, and result in the same number of series in a single graph. We can change that behaviour very easily thanks to a nice feature of Grafana: on the existing row, to the left, open the Row editor and in <em>Templating options</em> activate duplication from variable <em>app</em>. Save and refresh the browser.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-grafana-apps-rows.png" alt="Applications per row">
</div>
</div>
<div class="paragraph">
<p>That&#8217;s better! By turning on row duplication based on our variable, Grafana has created 3 rows, and for each one it provides to the Hawkular plugin just one value of <em>$app</em> at a time.</p>
</div>
<div class="paragraph">
<p>Now we can monitor our microservices quite easily! If we don&#8217;t want to see the <em>docker-build</em> instance, just filter it out with the top combo.</p>
</div>
<div class="paragraph">
<p>We will just add a little enhancement to the dashboard, to make easier to understand which row is for which app. On the first row, add a new <em>Text</em> panel, set its title empty, span 2, height 100px, mode HTML and content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>&lt;center&gt;&lt;p style='font-size: 40pt'&gt;$app&lt;/p&gt;&lt;/center&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will display the microservice name. After some layout arrangement, here is the final result:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-grafana-apps-rows-2.png" alt="Applications per row bis">
</div>
</div>
<div class="paragraph">
<p>You can play around with OpenShift. Scale some pods up and down, and you&#8217;ll get the metrics updated in Grafana. Just note that on downscaling, you&#8217;ll have to wait a little bit (5 minutes) before seeing the <em>Live</em> metrics on the <em>Singlestat</em> panel being updated. This is because we&#8217;re not sure if the absence of data is due to a pod being shut down, or a simple delay between measurements.</p>
</div>
</div>
<div class="sect2">
<h3 id="_it_s_just_a_beginning">It&#8217;s Just a Beginning</h3>
<div class="paragraph">
<p>Thanks to the metrics provided in OpenShift, you can build more elaborate dashboards. Just change the <em>desciptor_name</em> tag and see what&#8217;s interesting for you, there are metrics on memory, CPU, network and filesystem.</p>
</div>
<div class="paragraph">
<p>But that&#8217;s just the starting kit! <a href="http://www.hawkular.org/hawkular-clients/">The Hawkular Metrics ecosystem</a> is rich and keeps growing, including a Wildfly agent, a Vert.x plugin, a DropWizard reporter, etc. And if that&#8217;s not enough for you, it&#8217;s very easy to integrate your own metrics: either through the client libraries or by directly calling the <a href="http://www.hawkular.org/docs/rest/rest-metrics.html">Metrics REST API</a>.</p>
</div>
<div class="paragraph">
<p>A good practice, when you define your own metrics, is to tag them with some pod-discriminant values. It can be through the environment variables set by Kubernetes/OpenShift, but it could also be the hostname since it&#8217;s generated specifically for a pod. With that in mind, you will be able to monitor every part of your microservices architecture.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can download this dashboard <a href="https://github.com/hawkular/hawkular-grafana-datasource/blob/master/dashboards/openshift-memory-example.json">here on GitHub</a> and import it in Grafana.
</td>
</tr>
</table>
</div>
</div></p>
            <br />
            <hr /><br />
            <br />
            <a href="blog/2016/10/17/hawkular-apm-opentracing-and-alerts.html"><h1>Hawkular APM supports OpenTracing and Alerts</h1></a>
            <p>17 October 2016, by Gary Brown</p>
            <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://github.com/hawkular/hawkular-apm/releases/tag/0.11.0.Final">latest Hawkular APM release</a> includes two new features, a Java based <a href="http://opentracing.io/">OpenTracing</a> provider and integration with <a href="http://www.hawkular.org/community/docs/developer-guide/alerts.html">Hawkular Alerts</a>.</p>
</div>
<div class="paragraph">
<p>A video demonstrating these new features can also be viewed <a href="https://youtu.be/HSWSiww07RE">here</a>. The video starts with an explanation of how a vertx application is instrumented using OpenTracing. If you want to skip that explanation, then start <a href="https://youtu.be/HSWSiww07RE?t=7m47s">here for an explanation of the alert trigger</a> or start <a href="https://youtu.be/HSWSiww07RE?t=9m20s">here for the actual demo</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_an_example_vertx_application_instrumented_using_opentracing">An Example Vertx Application instrumented using OpenTracing</h3>
<div class="paragraph">
<p>As explained on the <a href="http://opentracing.io/">OpenTracing Website</a>, it is <em>"A vendor-neutral open standard for distributed tracing"</em>.</p>
</div>
<div class="paragraph">
<p>The project has been established to provide a consistent API, across multiple languages, to enable applications to be independent of any particular tracing solution. The currently supported languages are Java, Javascript, Go, Python, Objective-C and C++.</p>
</div>
<div class="paragraph">
<p>As part of the most recent <a href="https://github.com/hawkular/hawkular-apm/releases/tag/0.11.0.Final">Hawkular APM release (version 0.11)</a> we have implemented a Java based OpenTracing provider. To help demonstrate its use, we have instrumented an example <a href="http://vertx.io/">Vert.x</a> application that uses an asynchronous programming style with different interaction patterns (request/response and publish/subscribe). The code for the example can be found on <a href="https://github.com/hawkular/hawkular-apm/tree/0.11.0.Final/examples/vertx-opentracing">GitHub</a>.</p>
</div>
<div class="paragraph">
<p>Adding OpentTracing instrumentation to an application essentially involves creating a set of spans to demarcate significant points in your application that you wish to monitor. When a service receives a request from a client, it should first attempt to extract any existing state information from the client request before creating the top level span for the service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>        SpanContext spanCtx = tracer.extract(Format.Builtin.TEXT_MAP,
                new HttpHeadersExtractAdapter(routingContext.request().headers()));

        Span ordersConsumerSpan = tracer.buildSpan("POST")
                .asChildOf(spanCtx)
                .withTag("http.url", "/orders")
                .withTag("service", "OrderManager")
                .withTag("transaction", "Place Order")
                .start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>So in this case, we are receiving a request to place an order via a RESTful endpoint (i.e. POST /orders). The first statement extracts any trace state from the HTTP headers and stores them in a <em>SpanContext</em> which is then used when creating a <em>childOf</em> relationship for the top level span.</p>
</div>
<div class="paragraph">
<p>The additional tags we have specified are for information purposes. The <code>http.url</code> is used to identify two things, that the endpoint type is HTTP, and secondly the URL is <em>/orders</em>. The <code>service</code> tag is used to add information on the dependency graph, and finally the <code>transaction</code> enables the trace instance to be classified as belonging to this business transaction.</p>
</div>
<div class="paragraph">
<p>As this service is then making calls out to other services, we want to create a span to encapsulate the service invocation, and identify it as being a child span of the previously created span (i.e. to make it clear that this service invocation is being performed in the scope of the existing trace instance). The follow span represents the call out to the <em>AccountManager</em> to get account information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>        Span getAccountSpan = tracer.buildSpan("GetAccount")
                .asChildOf(ordersConsumerSpan)
                .start();

        tracer.inject(getAccountSpan.context(), Format.Builtin.TEXT_MAP,
                new VertxMessageInjectAdapter(order));

        eb.send("AccountManager.getAccount", order, acctresp -&gt; {
            getAccountSpan.finish();
            ....</code></pre>
</div>
</div>
<div class="paragraph">
<p>After creating the span, the second statement is used to <em>inject</em> the trace state into the message being sent to the <em>AccountManager</em>. This is necessary to ensure that the activities that occur within the account manager are linked to the same trace instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>        response.putHeader("content-type", "application/json")
                .setStatusCode(202).end(order.encodePrettily());

        ordersConsumerSpan.setTag("orderId", order.getString("id"));
        ordersConsumerSpan.setTag("itemId", order.getString("itemId"));
        ordersConsumerSpan.setTag("accountId", order.getString("accountId"));

        ordersConsumerSpan.finish();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, once the order has been confirmed, we associate some additional information with the top level span, before calling the <code>finish()</code> method.</p>
</div>
<div class="paragraph">
<p>This gives a brief insight into how an application can be instrumented to use the OpenTracing API. The <em>OrderManager</em> example is slightly more complex, in that it also instruments a subsequent publish of the order confirmation on the event bus, and relates the instrumentation back to the original trace using the <em>FOLLOWS_FROM</em> reference type. For more information please see the <a href="https://github.com/hawkular/hawkular-apm/tree/0.11.0.Final/examples/vertx-opentracing">code</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_analysing_the_captured_information">Analysing the Captured Information</h3>
<div class="paragraph">
<p>When starting the Hawkular APM console, the first page that is displayed shows details for the spans associated with the tracing information that has been captured from the application. The spans can represent <em>Consumers</em> that receive service requests, <em>Producers</em> that make service requests, or internal <em>Components</em> (e.g. databases).</p>
</div>
<div class="paragraph">
<p>As you can see, the values in the <em>Operation</em> column have the same values that were used when building the spans in the vertx application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-apm-vertx-components.png" alt="Application component details">
</div>
</div>
<div class="paragraph">
<p>On the <strong>Distributed Tracing</strong> page, we can view the dependencies between the services that were involved in placing the order (i.e. we have selected the <em>Place Order</em> business transaction). We could also filter based on individual properties to further refine the trace instances that are aggregated into this view.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-apm-vertx-dt.png" alt="Service dependencies">
</div>
</div>
<div class="paragraph">
<p>If we then select the <strong>Show 'n' instance details</strong> button, and select an instance from the table, you can view the flow of the individual trace instance:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-apm-vertx-instance.png" alt="Trace instance for placing an order">
</div>
</div>
<div class="paragraph">
<p>In this diagram, you can see how the order is first passed to the <em>AccountManager</em> to check the account id is known, followed by the <em>InventoryManager</em> to check the stock level. At this point the order confirmation is created and returned to the client application.</p>
</div>
<div class="paragraph">
<p>However this is not the end of the trace, as the Vertx application then publishes the order confirmation on the event bus, which is consumed by two services (<em>OrderLog</em> and <em>InventoryManager</em>) - which demonstrates tracing a publish/subscribe interaction. This behaviour is represented by a dotted line, as it is being performed concurrently, outside the scope of the main request/response interaction with the client application.</p>
</div>
<div class="paragraph">
<p>The following screenshot is the <strong>Business Transaction</strong> page, which shows a summary of the business transactions being managed by the server. In previous releases, the business transactions were configured on the server, based on information captured using the non-intrusive agent based approach.</p>
</div>
<div class="paragraph">
<p>With the explicit instrumentation of applications using the OpenTracing API, we have added the ability for the application to directly specify the name of the business transaction, which is then propagated with the trace state between interacting services. This means that business transactions don&#8217;t need to be configured on the server when specified via the OpenTracing API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-apm-vertx-btxnsummary.png" alt="Summary of business transactions">
</div>
</div>
<div class="paragraph">
<p>When a business transaction is selected from the summary page, it shows the detailed information:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-apm-vertx-btxn-placeorder.png" alt="Place order business transaction information">
</div>
</div>
<div class="paragraph">
<p>This screenshot shows how information specified via tags on the OpenTracing spans can be used to show faults and properties for the business transaction. Selecting the segments in the fault and properties pie charts can be used to further filter the information displayed on this page.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary">Summary</h3>
<div class="paragraph">
<p>In this blog and accompanying video we have shown how Hawkular APM can be used with an application instrumented using the standard OpenTracing API. The video also shows how trace information captured and reported to the Hawkular APM server can be used to trigger alerts defined using Hawkular Alerts.</p>
</div>
</div></p>
            <br />
            <hr /><br />
            <br />
            <a href="blog/2016/10/14/hawkular-apm-polyglot-zipkin.html"><h1>Hawkular APM Distributed Tracing of Polyglot Application using Zipkin Instrumentations</h1></a>
            <p>14 October 2016, by Pavol Loffay</p>
            <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The latest focus of Hawkular APM has been in building a compatibility layer
for Zipkin instrumented applications. This enables Hawkular APM to leverage
Zipkin <a href="http://zipkin.io/pages/existing_instrumentations.html">instrumentation libraries</a>
and instrument polyglot applications.</p>
</div>
<div class="paragraph">
<p>In this blog post we will look how to use Zipkin instrumentation libraries to instrument
polyglot environment and how the reported data looks in Hawkular APM and Zipkin server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_polyglot_application">Polyglot Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A typical polyglot application consists of multiple services written in different programming
languages. These services interact together to fulfill some business needs or tasks.</p>
</div>
<div class="paragraph">
<p>The following image shows the architecture of our polyglot application.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-zipkin-polyglot-arch.png" alt="apm zipkin polyglot arch">
</div>
<div class="title">Figure 1. Architecture of polyglot application</div>
</div>
<div class="paragraph">
<p>There are five applications written in 4 languages: Java, JavaScript, Python and Ruby.
It uses two databases MySQL and Apache Cassandra. Applications expose various REST endpoints
which simulate some behaviour. For example creating a user in a database or an asynchronous task.</p>
</div>
<div class="paragraph">
<p>Each application lives in a separate docker container. The whole environment can be deployed
using one line docker-compose command. Overall there are seven containers including Apache Kafka
to collect span data. The complete source code with instructions how to run it can be found on
<a href="https://github.com/hawkular/hawkular-apm/tree/master/examples/polyglot-zipkin">Github</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instrumentation_libraries">Instrumentation Libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several <a href="http://zipkin.io/pages/existing_instrumentations.html">zipkin instrumentation libraries</a>.
Developers have to choose the relevant libraries for their target language (and framework).
If there is no instrumentation for a specific framework they have to report spans to the
server explicitly, thus having an instrumentation library for a popular web framework is a big
advantage (not limited to web).</p>
</div>
<div class="paragraph">
<p>In a typical microservice environment it is also necessary to add instrumentation for outgoing
requests so one application may use two or more Zipkin compliant instrumentation libraries.
These two implementations have to share trace context, and therefore proper initialization
is required.</p>
</div>
<div class="paragraph">
<p>Our applications are instrumented with following instrumentations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java (JAX-RS): <a href="https://github.com/openzipkin/brave">brave</a></p>
</li>
<li>
<p>Java Dropwizard (JAX-RS): <a href="https://github.com/smoketurner/dropwizard-zipkin">dropwizard-zipkin</a> uses brave</p>
</li>
<li>
<p>Apache Cassandra: <a href="https://github.com/thelastpickle/cassandra-zipkin-tracing">cassandra-zipkin-tracing</a> uses brave</p>
</li>
<li>
<p>JavaScript (express, cujoJS): <a href="https://github.com/openzipkin/zipkin-js">zipkin-js</a></p>
</li>
<li>
<p>Ruby (rack): <a href="https://github.com/openzipkin/zipkin-ruby">zipkin-ruby</a></p>
</li>
<li>
<p>Python (Pyramid): <a href="https://github.com/Yelp/pyramid_zipkin">pyramid_zipkin</a></p>
</li>
<li>
<p>Python (Bravado): <a href="https://github.com/Yelp/swagger_zipkin">swagger_zipkin</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These libraries are typically developed by a community and therefore reported data may differ. For
example a key of binary annotation representing HTTP URL can be <code>http.url</code> or <code>http.uri</code> or even
<code>http.path</code>. Some of the libraries do not report HTTP status code. Name of a span often represents
HTTP method but some instrumentations put there URL or even other data (cassandra-zipkin-tracing).
It is not an invalid behaviour, just keep in mind when querying data or exporting to external systems for
an analysis.</p>
</div>
<div class="paragraph">
<p>There are also a couple of
<a href="https://github.com/hawkular/hawkular-apm/tree/master/examples/polyglot-zipkin#known-issues">issues</a>
which can lead to an incorrect data presentation in Hawkular APM. Issues were also reported to the Zipkin project.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_the_polyglot_application">Run the Polyglot Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Follow the instructions on
<a href="https://github.com/hawkular/hawkular-apm/tree/master/examples/polyglot-zipkin">Github</a>
to run the environment and start Hawkular APM server.</p>
</div>
<div class="paragraph">
<p>Execute following requests which we will analyze in the following sections.</p>
</div>
<div id="requests" class="listingblock">
<div class="title">Example HTTP requests</div>
<div class="content">
<pre>1. curl -ivX GET 'http://localhost:3001/nodejs/hello'
2. curl -ivX GET 'http://localhost:3000/dropwizard/A
3. curl -ivX GET 'http://localhost:3000/dropwizard/asyncTwoOutgoingCalls'
4. curl -ivX POST -H 'Content-Type: application/json' 'http://localhost:3001/nodejs/createUser' -d '{"name": "jdoe"}'</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_server_comparisons">Server Comparisons</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section compares user interfaces of Hawkular APM and Zipkin server.</p>
</div>
<div class="sect2">
<h3 id="_hawkular_apm_server">Hawkular APM Server</h3>
<div class="paragraph">
<p>In Hawkular APM user interface we are going to look at distributed tracing tab. If you run previous
commands there should be some data to analyze.</p>
</div>
<div class="paragraph">
<p>Following figure shows aggregated service interactions for selected initial endpoint (fourth request).
Nodes represent endpoint with URL and edges invocation flow.</p>
</div>
<div class="paragraph">
<p>Nodes holds statistics information like average, minimum and maximum duration,
total number of executions, service name and invoked URL.
Edges contain timing information of a network latency. This screen only shows nodes with a URL.
Databases and other components are shown in trace detail view.</p>
</div>
<div class="paragraph">
<p>For query capabilities we can specify time span, business transaction
(currently available only for java agent instrumentation and OpenTracing provider) and properties.
Properties represent binary annotations.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-distributed-tracing-createUser.png" alt="apm distributed tracing createUser">
</div>
<div class="title">Figure 2. Hawkular APM Distributed Tracing</div>
</div>
<div class="paragraph">
<p>Next screen shows instance details. In other words a list of traces for the selected initial endpoint.
Table contains basic information as collected properties, start time, principal (for java agent instrumentation)
and overall trace duration. Details button opens a detailed graph.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-instance-details.png" alt="apm instance details">
</div>
<div class="title">Figure 3. Hawkular APM Instance Details</div>
</div>
<div class="paragraph">
<p>In the detailed view users can see different types of nodes: producers (client span),
consumers (server span) and components (databases, EJBs). Tooltip is showing recorded binary annotations.
In this case it is a CQL query for storing an user into Apache Cassandra.</p>
</div>
<div class="paragraph">
<p>This concrete graph starts with a consumer (REST handler) and produces two producers (outgoing requests). These
requests are consumed by dropwizard and wildfly-swarm application and so on.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-instance-details-createUser.png" alt="apm instance details createUser">
</div>
<div class="title">Figure 4. Hawkular APM Instance Details</div>
</div>
</div>
<div class="sect2">
<h3 id="_zipkin_server">Zipkin Server</h3>
<div class="paragraph">
<p>Let&#8217;s compare this now how the native Zipkin server shows stuff. Please start Zipkin server and
execute requests from <a href="#requests">Example HTTP requests</a>.</p>
</div>
<div class="paragraph">
<p>The first thing we are going to look at is a query capability. The user interface
offers to specify service name and names of recorded spans of a given service.
It is possible to specify span&#8217;s start time, end time and duration range.
For a more specific query it is possible to query on binary annotations,
which is helpful if we are looking for specific spans, for example HTTP URL of invoked service.
In the following figure it can be seen that we specified URL and HTTP status code
of invoked service.</p>
</div>
<div class="paragraph">
<p>The result of the query shows one trace which consist of 23 spans.
There is also a trace duration time and information which services were invoked within
that trace (also with a duration if possible to calculate).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-zipkin-createUser-query.png" alt="apm zipkin createUser query">
</div>
<div class="title">Figure 5. Zipkin Query</div>
</div>
<div class="paragraph">
<p>The next screen is a trace instance view. It shows a timeline with timing data relative
to the trace start time. In the following figure there is a trace view for the third call.
It can be seen that it represent an asynchronous call. The first call ended before its
descendants.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-zipkin-async.png" alt="apm zipkin async">
</div>
<div class="title">Figure 6. Zipkin Trace Detail</div>
</div>
<div class="paragraph">
<p>When you click on a specific span it shows a span detail view with events recorded within
the span. There are also recorded binary annotations which denotes information like HTTP URL
or HTTP status code. Instrumented application can add custom binary annotations.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-zipkin-async-span-detail.png" alt="apm zipkin async span detail">
</div>
<div class="title">Figure 7. Zipkin Span Detail</div>
</div>
<div class="paragraph">
<p>The last Zipkin screen is showing dependencies between services. When you click on a specific
service it shows how many calls were triggered from a service to a service. The more calls to
the service the wider arrow.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-zipkin-dependencies.png" alt="apm zipkin dependencies">
</div>
<div class="title">Figure 8. Zipkin Service Dependencies</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have seen a brief comparison of Hawkular APM and Zipkin server. Both of these projects
display data differently. Hawkular APM is doing more high level aggregations based on user
specific filter with calculation of statistics. On the other side Zipkin displays spans in
"RAW" fashion. There are definitely advantages and disadvantages for both of these approaches.</p>
</div>
<div class="paragraph">
<p>We are always interested to hear feedback from users on how the information presentation may be
improved to provide a powerful tool to analyze timing data of distributed applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_links">Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Polyglot example: <a href="https://github.com/hawkular/hawkular-apm/tree/master/examples/polyglot-zipkin" class="bare">https://github.com/hawkular/hawkular-apm/tree/master/examples/polyglot-zipkin</a></p>
</li>
<li>
<p>Zipkin instrumentations: <a href="http://zipkin.io/pages/existing_instrumentations.html" class="bare">http://zipkin.io/pages/existing_instrumentations.html</a></p>
</li>
<li>
<p>Hawkular APM: <a href="https://github.com/hawkular/hawkular-apm" class="bare">https://github.com/hawkular/hawkular-apm</a></p>
</li>
<li>
<p>Zipkin: <a href="https://github.com/openzipkin/zipkin" class="bare">https://github.com/openzipkin/zipkin</a></p>
</li>
</ul>
</div>
</div>
</div></p>
            <br />
            <hr /><br />
            <br />



    <div class="large-4 columns blog-post-listings">
        <h2>Older posts:</h2>
        <ul>
          <li>06 October 2016 - <a href="blog/2016/10/06/hawkular-metrics-0.20.0.Final-released.html">Hawkular Metrics 0.20.0 - Release</a></li>
          <li>19 September 2016 - <a href="blog/2016/09/19/hawkular-apm-on-msa.html">Using Hawkular APM on Red Hat&apos;s Microservices Reference Architecture example</a></li>
          <li>14 September 2016 - <a href="blog/2016/09/14/consuming-hawkular-api-over-ssl.html">Consuming Hawkular API over SSL with self signed certificates</a></li>
          <li>05 September 2016 - <a href="blog/2016/09/05/hawkular-metrics-0.19.0.Final-released.html">Hawkular Metrics 0.19.0 - Release</a></li>
          <li>31 August 2016 - <a href="blog/2016/08/31/spark-metric-analysis.html">Metric Data Analysis using the Apache Spark</a></li>
          <li>11 August 2016 - <a href="blog/2016/08/11/vertx-agent-inventory-impl.html">Vert.x agent inventory implementation</a></li>
          <li>01 August 2016 - <a href="blog/2016/08/01/hawkular-metrics-0.18.0.Final-released.html">Hawkular Metrics 0.18.0 - Release</a></li>
          <li>19 July 2016 - <a href="blog/2016/07/19/android-client-progess.html">What is new in Android Client</a></li>
          <li>14 July 2016 - <a href="blog/2016/07/14/hawkular-apm-openshift.html">Monitoring Application Performance within Openshift</a></li>
          <li>14 July 2016 - <a href="blog/2016/07/14/hawkular-miq.html">Getting started with ManageIQ and Hawkular</a></li>
          <li>13 July 2016 - <a href="blog/2016/07/13/hawkfx.html">Introducing HawkFX</a></li>
          <li>12 July 2016 - <a href="blog/2016/07/12/hawkular-and-jmx-jolokia.html">Hawkular and JMX/Jolokia</a></li>
          <li>12 July 2016 - <a href="blog/2016/07/12/hawkular-and-prometheus.html">Hawkular and Prometheus</a></li>
          <li>06 July 2016 - <a href="blog/2016/07/06/hawkular-metrics-0.17.0.Final-released.html">Hawkular Metrics 0.17.0 - Release</a></li>
          <li>05 July 2016 - <a href="blog/2016/07/05/hawkular-services-0.0.5.Final.html">Hawkular Services 0.0.5.Final</a></li>
          <li>05 July 2016 - <a href="blog/2016/07/05/scaling-hawkular-alerting.html">Scaling stateful services: an example in Hawkular Alerting</a></li>
          <li>27 June 2016 - <a href="blog/2016/06/27/hawkular-apm-0.9-released.html">Hawkular APM 0.9.0.Final Released</a></li>
          <li>14 June 2016 - <a href="blog/2016/06/14/hawkular-services-0.0.2.Final.html">Hawkular Services 0.0.2.Final</a></li>
          <li>01 June 2016 - <a href="blog/2016/06/01/hawkular-btm-to-apm.html">Hawkular BTM component rename</a></li>
          <li>01 June 2016 - <a href="blog/2016/06/01/hawkular-metrics-0.16.0.Final-released.html">Hawkular Metrics 0.16.0 - Release</a></li>
          <li>26 May 2016 - <a href="blog/2016/05/26/hawkular-btm-booker-demo.html">Monitoring Microservices for Application Performance, Distributed Tracing and Business Transactions</a></li>
          <li>24 May 2016 - <a href="blog/2016/05/24/hawkular-btm-ticketmonster-demo.html">Obtaining business metrics without the need to instrument your application</a></li>
          <li>02 May 2016 - <a href="blog/2016/05/02/hawkular-metrics-0.15.0.Final-released.html">Hawkular Metrics 0.15.0 - Release</a></li>
          <li>28 April 2016 - <a href="blog/2016/04/28/new-packaging.html">New Hawkular packaging</a></li>
          <li>27 April 2016 - <a href="blog/2016/04/27/hawkular-inventory-0.15.0.Final-released.html">Hawkular Inventory 0.15.0.Final - Release</a></li>
          <li>22 April 2016 - <a href="blog/2016/04/22/collecting-metrics-from-prometheus-endpoints.html">Collecting Metrics from Prometheus Endpoints</a></li>
          <li>21 April 2016 - <a href="blog/2016/04/21/datamining-first-release.html">Hawkular Data Mining 0.1.0.Final Released</a></li>
          <li>19 April 2016 - <a href="blog/2016/04/19/jmxtrans-to-hawkular-metrics.html">Monitoring JVM applications with jmxtrans</a></li>
          <li>08 April 2016 - <a href="blog/2016/04/08/hawkular-manage-iq-sprint-demo.html">Hawkular in ManageIQ sprint demo(s)</a></li>
          <li>29 March 2016 - <a href="blog/2016/03/29/hawkular-metrics-0.14.0.Final-released.html">Hawkular Metrics 0.14.0 - Release</a></li>
          <li>21 March 2016 - <a href="blog/2016/03/20/qr-android.html">QR Code support for Android Client</a></li>
          <li>16 March 2016 - <a href="blog/2016/03/16/hawkular-metrics-roadmap.html">Hawkular Metrics - Roadmap</a></li>
          <li>15 March 2016 - <a href="blog/2016/03/15/hawkular-1.0.0.Alpha11-released.html">The eleventh milestone of Hawkular released</a></li>
          <li>02 March 2016 - <a href="blog/2016/03/02/hawkular-metrics-0.13.0.Final-released.html">Hawkular Metrics 0.13.0 - Release</a></li>
          <li>23 February 2016 - <a href="blog/2016/02/22/hawkular-manage-iq.html">Integration with ManageIQ</a></li>
          <li>02 February 2016 - <a href="blog/2016/02/02/hawkular-metrics-0.12.0.Final-released.html">Hawkular Metrics 0.12.0 - Release</a></li>
          <li>25 January 2016 - <a href="blog/2016/01/25/hawkular-btm-apm.html">Hawkular-BTM now includes Application Performance Management</a></li>
          <li>21 January 2016 - <a href="blog/2016/01/21/hawkular-1.0.0.Alpha9-released.html">The nineth milestone of Hawkular released</a></li>
          <li>21 January 2016 - <a href="blog/2016/01/21/hawkular-command-gateway-clients.html">Hawkular Command Gateway Clients</a></li>
          <li>20 January 2016 - <a href="blog/2016/01/20/hawkular-datamining-demo-hwk-alpha9.html">Hawkular Data Mining - Predictive Charts</a></li>
          <li>12 January 2016 - <a href="blog/2016/01/12/hawkular-metrics-0.11.0.Final-released.html">Hawkular Metrics 0.11.0 - Release</a></li>
          <li>05 January 2016 - <a href="blog/2016/01/05/we-are-hiring.html">We are hiring !</a></li>
          <li>16 December 2015 - <a href="blog/2015/12/16/hawkular-1.0.0.Alpha8-released.html">The eigth milestone of Hawkular released</a></li>
          <li>01 December 2015 - <a href="blog/2015/12/01/hawkular-btm-instrument-docker-image.html">BTM: Instrumenting an application running from a docker image</a></li>
          <li>30 November 2015 - <a href="blog/2015/11/30/hawkular-btm-0-6-0-released.html">Monitoring Business Transactions in JBoss Ticket Monster App (Part 2)</a></li>
          <li>19 November 2015 - <a href="blog/2015/11/19/hawkular-1.0.0.Alpha7-released.html">Yet another release of Hawkular, the seventh one !</a></li>
          <li>10 November 2015 - <a href="blog/2015/11/10/hawkular-btm-0-5-0-released.html">Monitoring Business Transactions in JBoss Ticket Monster App</a></li>
          <li>30 October 2015 - <a href="blog/2015/10/30/hawkular-metrics-0.8.0.Final-released.html">Hawkular Metrics 0.9.0 - Release</a></li>
          <li>30 October 2015 - <a href="blog/2015/11/30/hawkular-metrics-0.10.0.Final-released.html">Hawkular Metrics 0.10.0 - Release</a></li>
          <li>24 October 2015 - <a href="blog/2015/10/24/hawkular-datamining.html">Introduction to Hawkular Data Mining Module</a></li>
          <li>21 October 2015 - <a href="blog/2015/10/21/hawkular-1.0.0.Alpha6-released.html">The sixth milestone of Hawkular released</a></li>
          <li>12 October 2015 - <a href="blog/2015/10/12/hawkular-metrics-0.8.0.Final-released.html">Hawkular Metrics 0.8.0 - Release</a></li>
          <li>09 October 2015 - <a href="blog/2015/10/09/graph-db-performance.html">Titan Graph DB Performance Tips</a></li>
          <li>06 October 2015 - <a href="blog/2015/10/06/hawkular-btm-0-4-0-released.html">Hawkular-BTM 0.4.0 released</a></li>
          <li>05 October 2015 - <a href="blog/2015/10/05/hawkular-metrics-2k-commits.html">Hawkular Metrics - 2k Commits</a></li>
          <li>30 September 2015 - <a href="blog/2015/09/30/hawkular-metrics-0.7.0.Final-released.html">Hawkular Metrics 0.7.0 - Release</a></li>
          <li>23 September 2015 - <a href="blog/2015/09/23/hawkular-1.0.0.Alpha5-released.html">The fifth milestone of Hawkular released</a></li>
          <li>03 September 2015 - <a href="blog/2015/09/03/monitoring-rails-using-hawkular-metrics.html">Monitoring Rails App using Hawkular Metrics</a></li>
          <li>29 August 2015 - <a href="blog/2015/08/29/hawkular-metrics-0.6.0.Final-released.html">Hawkular Metrics 0.6.0 - Release</a></li>
          <li>27 August 2015 - <a href="blog/2015/08/27/hawkular-1.0.0.Alpha4-released.html">The fourth milestone of Hawkular released</a></li>
          <li>25 August 2015 - <a href="blog/2015/08/25/hawkular-alerts-autoresolve.html">Introduction to AutoResolve triggers</a></li>
          <li>19 August 2015 - <a href="blog/2015/08/19/hawkular-alerts-standalone.html">Using Hawkular Alerts as a standalone engine</a></li>
          <li>14 August 2015 - <a href="blog/2015/08/14/hawkular-btm-0.3.0-demo.html">Visualising Business Transaction Information using Hawkular BTM 0.3.0.Final with RTGov Integration</a></li>
          <li>30 July 2015 - <a href="blog/2015/07/30/hawkular-1.0.0.Alpha3-released.html">Hawkular, all good things make three!</a></li>
          <li>22 July 2015 - <a href="blog/2015/07/22/hawkular-btm-0.2.0-demo.html">Monitoring a Vert.x Application using Hawkular BTM 0.2.0.Final</a></li>
          <li>02 July 2015 - <a href="blog/2015/07/02/hawkular-1.0.0.Alpha2-released.html">Hawkular, the second release!</a></li>
          <li>01 July 2015 - <a href="blog/2015/07/01/hawkular-btm-0-1-0-released.html">Hawkular-BTM 0.1.0 released</a></li>
          <li>01 July 2015 - <a href="blog/2015/07/01/hawkular-btm-0.1.0-demo.html">Monitoring a SwitchYard Application using Hawkular BTM 0.1.0.Final</a></li>
          <li>22 June 2015 - <a href="blog/2015/06/23/hawkular-metrics-0-4-0-released.html">Hawkular Metrics 0.4.0 - Release</a></li>
          <li>17 June 2015 - <a href="blog/2015/06/17/marsjug-and-rivieradev-retrospective.html">MarsJUG and RivieraDEV retrospective</a></li>
          <li>04 June 2015 - <a href="blog/2015/06/04/hawkular-1.0.0.Alpha1-released.html">Hawkular, the first release!</a></li>
          <li>01 June 2015 - <a href="blog/2015/06/01/hawkular-metrics-0-3-4-released.html">Hawkular Metrics 0.3.4 - Release</a></li>
          <li>30 April 2015 - <a href="blog/2015/04/30/introducing-btm.html">Introducing the latest Hawkular component: Business Transaction Management</a></li>
          <li>29 April 2015 - <a href="blog/2015/04/29/hello-to-gsoc-students.html">Hello GSoC Students</a></li>
          <li>17 April 2015 - <a href="blog/2015/04/14/intro-to-hawkular.html">Intro to Hawkular, a middleware open-source management solution</a></li>
          <li>14 April 2015 - <a href="blog/2015/04/14/hawkular-monitor-agent-intro.html">Hawkular-Monitor Agent</a></li>
          <li>09 April 2015 - <a href="blog/2015/04/09/alert-notifiers-for-mobile-devices.html">Alert notifiers for mobile devices</a></li>
          <li>08 April 2015 - <a href="blog/2015/2015-04-08-1.html">Testing collectd integration</a></li>
          <li>07 April 2015 - <a href="blog/2015/2015-04-07-1.html">Hawkular Metrics 0.3.1 - Release</a></li>
          <li>01 April 2015 - <a href="blog/2015/2015-04-01-1.html">Hawkular Discontinued</a></li>
          <li>30 March 2015 - <a href="blog/2015/2015-03-30-1.html">Dockerized Hawkular builds available</a></li>
          <li>24 February 2015 - <a href="blog/2015/2015-02-24-1.html">The Kettle starts boiling</a></li>
          <li>16 February 2015 - <a href="blog/2015/2015-02-16-1.html">Hawkular Metrics 0.2.7 - Release</a></li>
        <br/><br/>
    </div>

    <a href=feed.xml><i class="fa fa-rss"></i> RSS Feed</a>
</div>


		</div>
		<div id="push"></div>
    </div>

    <section class="redhat clearfix">
      <div class="container">
        <p class="pull-left">
          <a href="http://www.redhat.com/">
            <img alt="redhatlogo-white" src="/img/redhatlogo-white.png" width="130">
          </a>
        </p>
        <p class="muted credit pull-right">
				  &copy; 2016 | Hawkular is released under <a href="/license.html">Apache License v2.0</a>
					<a href="https://twitter.com/hawkular_org" class="twitter-follow-button" data-show-count="false" data-size="medium">Follow @hawkular_org</a>
				  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
				</p>

    <!--p id="forkongithubp"><span id="forkongithub">
      <a href="https://github.com/hawkular" class="bg-grey">
        Fork me on GitHub
      </a>
    </span></p-->
      </div>
    </section>

    <!-- javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- js -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="js/jbossorg-tabzilla.js"></script>
    <script src="js/behavior.js"></script>
    <script src="js/prettify.js"></script>
    <script src="js//ekko-lightbox.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'hawkular';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61728352-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
