<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Hawkular</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- css -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/asciidoctor.css" rel="stylesheet">
    <link href="css/base.css" rel="stylesheet">
    <link href="css/tabzilla.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <link href="css/prettify.css" rel="stylesheet">
    <link href="css/ekko-lightbox.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
    <script src="js/moment.min.js"></script>
    <script src="js/jquery-1.11.2.min.js"></script>

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="alternate" href="feed.xml" title="Hawkular Blog - RSS" type="application/rss+xml">

  </head>
  <body onload="prettyPrint()" data-spy="scroll" data-offset="80" data-target="#toc">
    <div id="wrap">
      <div class="dropup">
        <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
        <script>
            window.addEventListener('load', function() {
                 renderTabzilla("Hawkular", "https://hawkular.github.io", true );
            }, false);
        </script>
      </div>

    	<!-- Fixed navbar -->
        <nav class="navbar navbar-fixed-top" role="navigation">
          <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button class="navbar-toggle collapsed" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="">Home</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav">
                <li><a href="overview/">Overview</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li class="dropdown">
                  <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                    Hawkular Services<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li class="menu-item dropdown dropdown-submenu">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation</a>
                      <ul class="dropdown-menu">
                        <li class="menu-item ">
                          <a href="hawkular-services/docs/quickstart-guide/">Quickstart</a>
                        </li>
                        <li class="menu-item ">
                          <a href="hawkular-services/docs/installation-guide/">Installation Guide</a>
                        </li>
                        <li class="menu-item ">
                          <a href="hawkular-services/docs/user-guide/">User Guide</a>
                        </li>
                        <li class="menu-item dropdown dropdown-submenu">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">REST API</a>
                          <ul class="dropdown-menu">
                            <li class="menu-item ">
                              <a href="docs/rest/rest-alerts.html">Alerting</a>
                            </li>
                            <li class="menu-item ">
                              <a href="docs/rest/rest-inventory.html">Inventory</a>
                            </li>
                            <li class="menu-item ">
                              <a href="docs/rest/rest-metrics.html">Metrics</a>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a href="https://github.com/hawkular/hawkular-services/releases">Download</a>
                    </li>
                  </ul>
                </li>
                <li class="dropdown">
                  <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                    Hawkular APM<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li>
                      <a href="https://hawkular.gitbooks.io/hawkular-apm-user-guide/content/">Documentation</a>
                    </li>
                    <li>
                      <a href="https://github.com/hawkular/hawkular-apm/releases/">Download</a>
                    </li>
                  </ul>
                </li>
                <li class="dropdown">
                  <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                    Hawkular Metrics<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                  <li class="menu-item dropdown dropdown-submenu">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation</a>
                      <ul class="dropdown-menu">
                        <li class="menu-item ">
                          <a href="hawkular-metrics/docs/user-guide/">User Guide</a>
                        </li>
                        <li class="menu-item ">
                          <a href="docs/rest/rest-metrics.html">Metrics REST API</a>
                        </li>
                        <li class="menu-item ">
                          <a href="docs/rest/rest-alerts.html">Alerting REST API</a>
                        </li>
                      </ul>
                  </li>
                    <li>
                      <a href="https://github.com/hawkular/hawkular-metrics/releases/">Download</a>
                    </li>
                  </ul>
                </li>
                <li><a href="hawkular-clients/">Hawkular Clients</a></li>
                <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                  Community
                  <span class="caret"></span>
                </a>
                <ul class="dropdown-menu" role="menu">
                  <li>
                    <a href="community/docs/getting-involved/">Getting Involved</a>
                  </li>
                  <li class="menu-item ">
                    <a href="community/docs/developer-guide/">Developer Guide</a>
                  </li>
                  <li class="menu-item dropdown dropdown-submenu">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Labs</a>
                      <ul class="dropdown-menu">
                        <li class="menu-item ">
                          <a href="community/labs/datamining/">Datamining</a>
                        </li>
                        <li class="menu-item ">
                          <a href="https://github.com/pilhuhn/hawkfx">HawkFX</a>
                        </li>
                        <li class="menu-item ">
                          <a href="hawkular-clients/android-client/">Android client</a>
                        </li>
                      </ul>
                  </li>
                  <li>
                    <a href="https://github.com/hawkular">GitHub Repositories</a>
                  <li>
                    <a href="https://travis-ci.org/hawkular">CI Builds</a>
                  </li>
                </ul></li>
              </ul>
            </div>
          </div>
        </nav>


<section class="main-banner blog-mainbanner">
    <div class="container">
        <h1>Hawkular Blog</h1>
    </div>
</section>


<div class="blog-container">
            <a href="blog/2016/10/17/hawkular-apm-opentracing-and-alerts.html"><h1>Hawkular APM supports OpenTracing and Alerts</h1></a>
            <p>17 October 2016, by Gary Brown</p>
            <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://github.com/hawkular/hawkular-apm/releases/tag/0.11.0.Final">latest Hawkular APM release</a> includes two new features, a Java based <a href="http://opentracing.io/">OpenTracing</a> provider and integration with <a href="http://www.hawkular.org/community/docs/developer-guide/alerts.html">Hawkular Alerts</a>.</p>
</div>
<div class="paragraph">
<p>A video demonstrating these new features can also be viewed <a href="https://youtu.be/HSWSiww07RE">here</a>. The video starts with an explanation of how a vertx application is instrumented using OpenTracing. If you want to skip that explanation, then start <a href="https://youtu.be/HSWSiww07RE?t=7m47s">here for an explanation of the alert trigger</a> or start <a href="https://youtu.be/HSWSiww07RE?t=9m20s">here for the actual demo</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_an_example_vertx_application_instrumented_using_opentracing">An Example Vertx Application instrumented using OpenTracing</h3>
<div class="paragraph">
<p>As explained on the <a href="http://opentracing.io/">OpenTracing Website</a>, it is <em>"A vendor-neutral open standard for distributed tracing"</em>.</p>
</div>
<div class="paragraph">
<p>The project has been established to provide a consistent API, across multiple languages, to enable applications to be independent of any particular tracing solution. The currently supported languages are Java, Javascript, Go, Python, Objective-C and C++.</p>
</div>
<div class="paragraph">
<p>As part of the most recent <a href="https://github.com/hawkular/hawkular-apm/releases/tag/0.11.0.Final">Hawkular APM release (version 0.11)</a> we have implemented a Java based OpenTracing provider. To help demonstrate its use, we have instrumented an example <a href="http://vertx.io/">Vert.x</a> application that uses an asynchronous programming style with different interaction patterns (request/response and publish/subscribe). The code for the example can be found on <a href="https://github.com/hawkular/hawkular-apm/tree/0.11.0.Final/examples/vertx-opentracing">GitHub</a>.</p>
</div>
<div class="paragraph">
<p>Adding OpentTracing instrumentation to an application essentially involves creating a set of spans to demarcate significant points in your application that you wish to monitor. When a service receives a request from a client, it should first attempt to extract any existing state information from the client request before creating the top level span for the service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>        SpanContext spanCtx = tracer.extract(Format.Builtin.TEXT_MAP,
                new HttpHeadersExtractAdapter(routingContext.request().headers()));

        Span ordersConsumerSpan = tracer.buildSpan("POST")
                .asChildOf(spanCtx)
                .withTag("http.url", "/orders")
                .withTag("service", "OrderManager")
                .withTag("transaction", "Place Order")
                .start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>So in this case, we are receiving a request to place an order via a RESTful endpoint (i.e. POST /orders). The first statement extracts any trace state from the HTTP headers and stores them in a <em>SpanContext</em> which is then used when creating a <em>childOf</em> relationship for the top level span.</p>
</div>
<div class="paragraph">
<p>The additional tags we have specified are for information purposes. The <code>http.url</code> is used to identify two things, that the endpoint type is HTTP, and secondly the URL is <em>/orders</em>. The <code>service</code> tag is used to add information on the dependency graph, and finally the <code>transaction</code> enables the trace instance to be classified as belonging to this business transaction.</p>
</div>
<div class="paragraph">
<p>As this service is then making calls out to other services, we want to create a span to encapsulate the service invocation, and identify it as being a child span of the previously created span (i.e. to make it clear that this service invocation is being performed in the scope of the existing trace instance). The follow span represents the call out to the <em>AccountManager</em> to get account information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>        Span getAccountSpan = tracer.buildSpan("GetAccount")
                .asChildOf(ordersConsumerSpan)
                .start();

        tracer.inject(getAccountSpan.context(), Format.Builtin.TEXT_MAP,
                new VertxMessageInjectAdapter(order));

        eb.send("AccountManager.getAccount", order, acctresp -&gt; {
            getAccountSpan.finish();
            ....</code></pre>
</div>
</div>
<div class="paragraph">
<p>After creating the span, the second statement is used to <em>inject</em> the trace state into the message being sent to the <em>AccountManager</em>. This is necessary to ensure that the activities that occur within the account manager are linked to the same trace instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>        response.putHeader("content-type", "application/json")
                .setStatusCode(202).end(order.encodePrettily());

        ordersConsumerSpan.setTag("orderId", order.getString("id"));
        ordersConsumerSpan.setTag("itemId", order.getString("itemId"));
        ordersConsumerSpan.setTag("accountId", order.getString("accountId"));

        ordersConsumerSpan.finish();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, once the order has been confirmed, we associate some additional information with the top level span, before calling the <code>finish()</code> method.</p>
</div>
<div class="paragraph">
<p>This gives a brief insight into how an application can be instrumented to use the OpenTracing API. The <em>OrderManager</em> example is slightly more complex, in that it also instruments a subsequent publish of the order confirmation on the event bus, and relates the instrumentation back to the original trace using the <em>FOLLOWS_FROM</em> reference type. For more information please see the <a href="https://github.com/hawkular/hawkular-apm/tree/0.11.0.Final/examples/vertx-opentracing">code</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_analysing_the_captured_information">Analysing the Captured Information</h3>
<div class="paragraph">
<p>When starting the Hawkular APM console, the first page that is displayed shows details for the spans associated with the tracing information that has been captured from the application. The spans can represent <em>Consumers</em> that receive service requests, <em>Producers</em> that make service requests, or internal <em>Components</em> (e.g. databases).</p>
</div>
<div class="paragraph">
<p>As you can see, the values in the <em>Operation</em> column have the same values that were used when building the spans in the vertx application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-apm-vertx-components.png" alt="Application component details">
</div>
</div>
<div class="paragraph">
<p>On the <strong>Distributed Tracing</strong> page, we can view the dependencies between the services that were involved in placing the order (i.e. we have selected the <em>Place Order</em> business transaction). We could also filter based on individual properties to further refine the trace instances that are aggregated into this view.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-apm-vertx-dt.png" alt="Service dependencies">
</div>
</div>
<div class="paragraph">
<p>If we then select the <strong>Show 'n' instance details</strong> button, and select an instance from the table, you can view the flow of the individual trace instance:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-apm-vertx-instance.png" alt="Trace instance for placing an order">
</div>
</div>
<div class="paragraph">
<p>In this diagram, you can see how the order is first passed to the <em>AccountManager</em> to check the account id is known, followed by the <em>InventoryManager</em> to check the stock level. At this point the order confirmation is created and returned to the client application.</p>
</div>
<div class="paragraph">
<p>However this is not the end of the trace, as the Vertx application then publishes the order confirmation on the event bus, which is consumed by two services (<em>OrderLog</em> and <em>InventoryManager</em>) - which demonstrates tracing a publish/subscribe interaction. This behaviour is represented by a dotted line, as it is being performed concurrently, outside the scope of the main request/response interaction with the client application.</p>
</div>
<div class="paragraph">
<p>The following screenshot is the <strong>Business Transaction</strong> page, which shows a summary of the business transactions being managed by the server. In previous releases, the business transactions were configured on the server, based on information captured using the non-intrusive agent based approach.</p>
</div>
<div class="paragraph">
<p>With the explicit instrumentation of applications using the OpenTracing API, we have added the ability for the application to directly specify the name of the business transaction, which is then propagated with the trace state between interacting services. This means that business transactions don&#8217;t need to be configured on the server when specified via the OpenTracing API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-apm-vertx-btxnsummary.png" alt="Summary of business transactions">
</div>
</div>
<div class="paragraph">
<p>When a business transaction is selected from the summary page, it shows the detailed information:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-10-17-apm-vertx-btxn-placeorder.png" alt="Place order business transaction information">
</div>
</div>
<div class="paragraph">
<p>This screenshot shows how information specified via tags on the OpenTracing spans can be used to show faults and properties for the business transaction. Selecting the segments in the fault and properties pie charts can be used to further filter the information displayed on this page.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary">Summary</h3>
<div class="paragraph">
<p>In this blog and accompanying video we have shown how Hawkular APM can be used with an application instrumented using the standard OpenTracing API. The video also shows how trace information captured and reported to the Hawkular APM server can be used to trigger alerts defined using Hawkular Alerts.</p>
</div>
</div></p>
            <br />
            <hr /><br />
            <br />
            <a href="blog/2016/10/14/hawkular-apm-polyglot-zipkin.html"><h1>Hawkular APM Distributed Tracing of Polyglot Application using Zipkin Instrumentations</h1></a>
            <p>14 October 2016, by Pavol Loffay</p>
            <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The latest focus of Hawkular APM has been in building a compatibility layer
for Zipkin instrumented applications. This enables Hawkular APM to leverage
Zipkin <a href="http://zipkin.io/pages/existing_instrumentations.html">instrumentation libraries</a>
and instrument polyglot applications.</p>
</div>
<div class="paragraph">
<p>In this blog post we will look how to use Zipkin instrumentation libraries to instrument
polyglot environment and how the reported data looks in Hawkular APM and Zipkin server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_polyglot_application">Polyglot Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A typical polyglot application consists of multiple services written in different programming
languages. These services interact together to fulfill some business needs or tasks.</p>
</div>
<div class="paragraph">
<p>The following image shows the architecture of our polyglot application.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-zipkin-polyglot-arch.png" alt="apm zipkin polyglot arch">
</div>
<div class="title">Figure 1. Architecture of polyglot application</div>
</div>
<div class="paragraph">
<p>There are five applications written in 4 languages: Java, JavaScript, Python and Ruby.
It uses two databases MySQL and Apache Cassandra. Applications expose various REST endpoints
which simulate some behaviour. For example creating a user in a database or an asynchronous task.</p>
</div>
<div class="paragraph">
<p>Each application lives in a separate docker container. The whole environment can be deployed
using one line docker-compose command. Overall there are seven containers including Apache Kafka
to collect span data. The complete source code with instructions how to run it can be found on
<a href="https://github.com/hawkular/hawkular-apm/tree/master/examples/polyglot-zipkin">Github</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instrumentation_libraries">Instrumentation Libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several <a href="http://zipkin.io/pages/existing_instrumentations.html">zipkin instrumentation libraries</a>.
Developers have to choose the relevant libraries for their target language (and framework).
If there is no instrumentation for a specific framework they have to report spans to the
server explicitly, thus having an instrumentation library for a popular web framework is a big
advantage (not limited to web).</p>
</div>
<div class="paragraph">
<p>In a typical microservice environment it is also necessary to add instrumentation for outgoing
requests so one application may use two or more Zipkin compliant instrumentation libraries.
These two implementations have to share trace context, and therefore proper initialization
is required.</p>
</div>
<div class="paragraph">
<p>Our applications are instrumented with following instrumentations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java (JAX-RS): <a href="https://github.com/openzipkin/brave">brave</a></p>
</li>
<li>
<p>Java Dropwizard (JAX-RS): <a href="https://github.com/smoketurner/dropwizard-zipkin">dropwizard-zipkin</a> uses brave</p>
</li>
<li>
<p>Apache Cassandra: <a href="https://github.com/thelastpickle/cassandra-zipkin-tracing">cassandra-zipkin-tracing</a> uses brave</p>
</li>
<li>
<p>JavaScript (express, cujoJS): <a href="https://github.com/openzipkin/zipkin-js">zipkin-js</a></p>
</li>
<li>
<p>Ruby (rack): <a href="https://github.com/openzipkin/zipkin-ruby">zipkin-ruby</a></p>
</li>
<li>
<p>Python (Pyramid): <a href="https://github.com/Yelp/pyramid_zipkin">pyramid_zipkin</a></p>
</li>
<li>
<p>Python (Bravado): <a href="https://github.com/Yelp/swagger_zipkin">swagger_zipkin</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These libraries are typically developed by a community and therefore reported data may differ. For
example a key of binary annotation representing HTTP URL can be <code>http.url</code> or <code>http.uri</code> or even
<code>http.path</code>. Some of the libraries do not report HTTP status code. Name of a span often represents
HTTP method but some instrumentations put there URL or even other data (cassandra-zipkin-tracing).
It is not an invalid behaviour, just keep in mind when querying data or exporting to external systems for
an analysis.</p>
</div>
<div class="paragraph">
<p>There are also a couple of
<a href="https://github.com/hawkular/hawkular-apm/tree/master/examples/polyglot-zipkin#known-issues">issues</a>
which can lead to an incorrect data presentation in Hawkular APM. Issues were also reported to the Zipkin project.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_the_polyglot_application">Run the Polyglot Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Follow the instructions on
<a href="https://github.com/hawkular/hawkular-apm/tree/master/examples/polyglot-zipkin">Github</a>
to run the environment and start Hawkular APM server.</p>
</div>
<div class="paragraph">
<p>Execute following requests which we will analyze in the following sections.</p>
</div>
<div id="requests" class="listingblock">
<div class="title">Example HTTP requests</div>
<div class="content">
<pre>1. curl -ivX GET 'http://localhost:3001/nodejs/hello'
2. curl -ivX GET 'http://localhost:3000/dropwizard/A
3. curl -ivX GET 'http://localhost:3000/dropwizard/asyncTwoOutgoingCalls'
4. curl -ivX POST -H 'Content-Type: application/json' 'http://localhost:3001/nodejs/createUser' -d '{"name": "jdoe"}'</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_server_comparisons">Server Comparisons</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section compares user interfaces of Hawkular APM and Zipkin server.</p>
</div>
<div class="sect2">
<h3 id="_hawkular_apm_server">Hawkular APM Server</h3>
<div class="paragraph">
<p>In Hawkular APM user interface we are going to look at distributed tracing tab. If you run previous
commands there should be some data to analyze.</p>
</div>
<div class="paragraph">
<p>Following figure shows aggregated service interactions for selected initial endpoint (fourth request).
Nodes represent endpoint with URL and edges invocation flow.</p>
</div>
<div class="paragraph">
<p>Nodes holds statistics information like average, minimum and maximum duration,
total number of executions, service name and invoked URL.
Edges contain timing information of a network latency. This screen only shows nodes with a URL.
Databases and other components are shown in trace detail view.</p>
</div>
<div class="paragraph">
<p>For query capabilities we can specify time span, business transaction
(currently available only for java agent instrumentation and OpenTracing provider) and properties.
Properties represent binary annotations.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-distributed-tracing-createUser.png" alt="apm distributed tracing createUser">
</div>
<div class="title">Figure 2. Hawkular APM Distributed Tracing</div>
</div>
<div class="paragraph">
<p>Next screen shows instance details. In other words a list of traces for the selected initial endpoint.
Table contains basic information as collected properties, start time, principal (for java agent instrumentation)
and overall trace duration. Details button opens a detailed graph.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-instance-details.png" alt="apm instance details">
</div>
<div class="title">Figure 3. Hawkular APM Instance Details</div>
</div>
<div class="paragraph">
<p>In the detailed view users can see different types of nodes: producers (client span),
consumers (server span) and components (databases, EJBs). Tooltip is showing recorded binary annotations.
In this case it is a CQL query for storing an user into Apache Cassandra.</p>
</div>
<div class="paragraph">
<p>This concrete graph starts with a consumer (REST handler) and produces two producers (outgoing requests). These
requests are consumed by dropwizard and wildfly-swarm application and so on.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-instance-details-createUser.png" alt="apm instance details createUser">
</div>
<div class="title">Figure 4. Hawkular APM Instance Details</div>
</div>
</div>
<div class="sect2">
<h3 id="_zipkin_server">Zipkin Server</h3>
<div class="paragraph">
<p>Let&#8217;s compare this now how the native Zipkin server shows stuff. Please start Zipkin server and
execute requests from <a href="#requests">Example HTTP requests</a>.</p>
</div>
<div class="paragraph">
<p>The first thing we are going to look at is a query capability. The user interface
offers to specify service name and names of recorded spans of a given service.
It is possible to specify span&#8217;s start time, end time and duration range.
For a more specific query it is possible to query on binary annotations,
which is helpful if we are looking for specific spans, for example HTTP URL of invoked service.
In the following figure it can be seen that we specified URL and HTTP status code
of invoked service.</p>
</div>
<div class="paragraph">
<p>The result of the query shows one trace which consist of 23 spans.
There is also a trace duration time and information which services were invoked within
that trace (also with a duration if possible to calculate).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-zipkin-createUser-query.png" alt="apm zipkin createUser query">
</div>
<div class="title">Figure 5. Zipkin Query</div>
</div>
<div class="paragraph">
<p>The next screen is a trace instance view. It shows a timeline with timing data relative
to the trace start time. In the following figure there is a trace view for the third call.
It can be seen that it represent an asynchronous call. The first call ended before its
descendants.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-zipkin-async.png" alt="apm zipkin async">
</div>
<div class="title">Figure 6. Zipkin Trace Detail</div>
</div>
<div class="paragraph">
<p>When you click on a specific span it shows a span detail view with events recorded within
the span. There are also recorded binary annotations which denotes information like HTTP URL
or HTTP status code. Instrumented application can add custom binary annotations.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-zipkin-async-span-detail.png" alt="apm zipkin async span detail">
</div>
<div class="title">Figure 7. Zipkin Span Detail</div>
</div>
<div class="paragraph">
<p>The last Zipkin screen is showing dependencies between services. When you click on a specific
service it shows how many calls were triggered from a service to a service. The more calls to
the service the wider arrow.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="/img/blog/2016/apm-zipkin-dependencies.png" alt="apm zipkin dependencies">
</div>
<div class="title">Figure 8. Zipkin Service Dependencies</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have seen a brief comparison of Hawkular APM and Zipkin server. Both of these projects
display data differently. Hawkular APM is doing more high level aggregations based on user
specific filter with calculation of statistics. On the other side Zipkin displays spans in
"RAW" fashion. There are definitely advantages and disadvantages for both of these approaches.</p>
</div>
<div class="paragraph">
<p>We are always interested to hear feedback from users on how the information presentation may be
improved to provide a powerful tool to analyze timing data of distributed applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_links">Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Polyglot example: <a href="https://github.com/hawkular/hawkular-apm/tree/master/examples/polyglot-zipkin" class="bare">https://github.com/hawkular/hawkular-apm/tree/master/examples/polyglot-zipkin</a></p>
</li>
<li>
<p>Zipkin instrumentations: <a href="http://zipkin.io/pages/existing_instrumentations.html" class="bare">http://zipkin.io/pages/existing_instrumentations.html</a></p>
</li>
<li>
<p>Hawkular APM: <a href="https://github.com/hawkular/hawkular-apm" class="bare">https://github.com/hawkular/hawkular-apm</a></p>
</li>
<li>
<p>Zipkin: <a href="https://github.com/openzipkin/zipkin" class="bare">https://github.com/openzipkin/zipkin</a></p>
</li>
</ul>
</div>
</div>
</div></p>
            <br />
            <hr /><br />
            <br />
            <a href="blog/2016/10/06/hawkular-metrics-0.20.0.Final-released.html"><h1>Hawkular Metrics 0.20.0 - Release</h1></a>
            <p>06 October 2016, by Stefan Negrea</p>
            <p><p>I am happy to announce release 0.20.0 of Hawkular Metrics.This is a major release anchored by the inclusion of <a href="https://github.com/hawkular/hawkular-alerts">Hawkular Alerting</a> in the distribution, a brand new compression algorithm, and numerous API enhancements and fixes.</p><p><strong>Hawkular Metrics + Alerting</strong></p><p>Hawkular Metrics now includes Hawkular Alerting out of the box; it's no longer necessary to install and manage two separate components. Hawkular Metrics delivers a single EAR file containing components from both projects. Incoming metric data is efficiently filtered and evaluated, generating alerts and events for defined triggers. The combined EAR artifact is the primary binary distribution of Hawkular Metrics going forward. For more details: <a href="https://issues.jboss.org/browse/HWKMETRICS-491">HWKMETRICS-491</a></p><p>Hawkular Alerting Details</p>
<ul>
  <li>Version <a href="https://issues.jboss.org/browse/HWKALERTS/fixforversion/12331699/">1.2.1</a> is included in this release</li>
  <li>Project details and repository: <a href="https://github.com/hawkular/hawkular-alerts">Hawkular Alerting - Github</a></li>
  <li>Documentation: <a href="http://www.hawkular.org/docs/rest/rest-alerts.html">Hawkular Alerting REST API Documentation</a>, <a href="https://github.com/hawkular/hawkular-alerts/tree/master/examples">Hawkular Alerting Examples</a>,<br/><a href="http://www.hawkular.org/community/docs/developer-guide/alerts.html">Hawkular Alerting Developer Guide</a></li>
</ul><p>Deployment Notes</p>
<ol>
  <li>Deployment Naming
  <ul>
    <li>The new EAR should be deployed as 'hawkular-metrics.ear' in WildFly. This naming is required to allow for proper dependencies to be established by the EAR components.</li>
  </ul></li>
  <li><code>standalone.xml</code> Configuration
  <ul>
    <li>The following snippet must be added to <code>standalone.xml</code> to support the Hawkular Alerting component. Add this additional cache-container entry after the existing cache-container entries:<br/><code>xml
&lt;cache-container name=&quot;hawkular-alerts&quot; module=&quot;org.jboss.as.clustering.infinispan&quot;&gt;
&lt;local-cache name=&quot;partition&quot;/&gt;
&lt;local-cache name=&quot;triggers&quot;/&gt;
&lt;local-cache name=&quot;data&quot;/&gt;
&lt;local-cache name=&quot;publish&quot;/&gt;
&lt;local-cache name=&quot;schema&quot;/&gt;
&lt;/cache-container&gt;
</code></li>
  </ul></li>
</ol><p>Usage Notes</p><p>To use Hawkular Alerting with Hawkular Metrics there is a naming convention when defining trigger conditions. For a metric with name 'X', the alerting DataId to reference it will be '<prefix>_X', where the <prefix> depends on the metric's type. For example, let's consider a metric with name 'HeapUsed' and type 'gauge'. This example defines a trigger condition to test if the used heap exceeded 80%: <code>hm_g_HeapUsed &gt; .8</code>. The 'hm_g_' prefix indicates that HeapUsed is a gauge.</p><p>Because Hawkular Metrics allows the same metric name for different types, the prefix is needed to make clear the target metric. The prefixes are:</p>
<ul>
  <li>hm_a: availability</li>
  <li>hm_c: counter</li>
  <li>hm_cr: counter rate</li>
  <li>hm_g: gauge</li>
  <li>hm_gr: gauge rate</li>
  <li>hm_s: string</li>
</ul><p><strong>Compression</strong></p><p>Hawkular Metrics will now compress all the data with a compression scheme based on Facebook's Gorilla paper. A job will be run every two hours that compresses data received during the 2 hour block since last compression (there's one hour time for out-of-order writes to be written to the Cassandra). These data points are then written to a new storage format that's designed after the Gorilla compression and also compressed with the LZ4 algorithm to give even better compression ratio. Benefits include a faster reading time of larger block of datapoints and very large disk space savings. For more details: <a href="https://issues.jboss.org/browse/HWKMETRICS-464">HWKMETRICS-464</a></p><p><strong>Other major changes</strong></p>
<ul>
  <li><p>REST API - Query Improvements</p>
  <ul>
    <li>Querying raw &amp; rate data by tags is now also possible via POST <code>{metric_type}/query</code> endpoints for all types of metrics (<a href="https://issues.jboss.org/browse/HWKMETRICS-466">HWKMETRICS-466</a>)</li>
    <li>Added new POST endpoints for stats <code>gauges/stats/query</code> and <code>counters/stats/query</code> (<a href="https://issues.jboss.org/browse/HWKMETRICS-465">HWKMETRICS-465</a>)</li>
    <li>It is now possible to fetch metric definitions filtered by a list of ids not just tags (<a href="https://issues.jboss.org/browse/HWKMETRICS-461">HWKMETRICS-461</a>)</li>
  </ul></li>
  <li><p>Cassandra Driver Configuration</p>
  <ul>
    <li>Driver configuration options are now exposed for connection and request timeouts</li>
    <li>Connection timeout can be configured via <code>CASSANDRA_CONNECTION_TIMEOUT</code> environment variable, or <code>hawkular-metrics.cassandra.connection.timeout</code> system property; value is specified in milliseconds and defaults to 5 seconds.</li>
    <li>Request timeout can be configured via <code>CASSANDRA_REQUEST_TIMEOUT</code> environment variable, or <code>hawkular-metrics.cassandra.request.timeout</code> system property; value is specified in milliseconds and defaults to 12 seconds.</li>
    <li>For more details: (<a href="https://issues.jboss.org/browse/HWKMETRICS-490">HWKMETRICS-490</a>)</li>
  </ul></li>
  <li><p>Job Scheduler</p>
  <ul>
    <li>Duplicate instances of jobs were wrongly scheduled on server restart because the job scheduler was not checking if the job was already scheduled (<a href="https://issues.jboss.org/browse/HWKMETRICS-461">HWKMETRICS-461</a>)</li>
    <li>Triggers now have a delay to properly schedule jobs in the future (<a href="https://issues.jboss.org/browse/HWKMETRICS-224">HWKMETRICS-224</a>)</li>
    <li>Resolved an issue where long running job can miss future executions because the current execution takes longer than the repeat interval (<a href="https://issues.jboss.org/browse/HWKMETRICS-477">HWKMETRICS-477</a>)</li>
    <li>Prevent execution of a job multiple times for the same execution time (<a href="https://issues.jboss.org/browse/HWKMETRICS-486">HWKMETRICS-486</a>)</li>
    <li>RepeatingTrigger now allows specifying trigger start time (<a href="https://issues.jboss.org/browse/HWKMETRICS-476">HWKMETRICS-476</a>)</li>
  </ul></li>
  <li><p>Admin Endpoints</p>
  <ul>
    <li>Admin related endpoints are going to be protected via an admin token, to be sent for admin related REST endpoints via Hawkular-Admin-Token request header</li>
    <li>The first endpoint to be protected by this mechanism is <code>/tenants</code> since its functionality is cross tenant</li>
    <li>The admin token can be set via command line arguments or environment variable at container startup; by default it is not set which means no access to protected endpoints</li>
    <li>This is the foundation for adding more admin related functionality in upcoming releases (such as Cassandra cluster metrics, system telemetry, or admin operations)</li>
    <li>The details:
    <ul>
      <li>system property key: hawkular.metrics.admin-token</li>
      <li>environment variable: ADMIN_TOKEN</li>
      <li>default value: null (admin endpoints are not accessible until set)</li>
      <li>header name: Hawkular-Admin-Token</li>
      <li>stored on the system config using one way hashing</li>
    </ul></li>
    <li>For more details: <a href="https://issues.jboss.org/browse/HWKMETRICS-478">HWKMETRICS-478</a></li>
  </ul></li>
</ul><p><strong>Hawkular Metrics Clients</strong></p>
<ul>
  <li>Python: <a href="https://github.com/hawkular/hawkular-client-python">https://github.com/hawkular/hawkular-client-python</a></li>
  <li>Go: <a href="https://github.com/hawkular/hawkular-client-go">https://github.com/hawkular/hawkular-client-go</a></li>
  <li>Ruby: <a href="https://github.com/hawkular/hawkular-client-ruby">https://github.com/hawkular/hawkular-client-ruby</a></li>
  <li>Java: <a href="https://github.com/hawkular/hawkular-client-java">https://github.com/hawkular/hawkular-client-java</a></li>
</ul><h3>Release Links</h3>
<ul>
  <li>Github Release: <a href="https://github.com/hawkular/hawkular-metrics/releases/tag/0.20.0">https://github.com/hawkular/hawkular-metrics/releases/tag/0.20.0</a></li>
  <li>JBoss Nexus Maven artifacts: <a href="http://origin-repository.jboss.org/nexus/content/repositories/public/org/hawkular/metrics/">http://origin-repository.jboss.org/nexus/content/repositories/public/org/hawkular/metrics/</a></li>
  <li>Jira release tracker: <a href="https://issues.jboss.org/browse/HWKMETRICS/fixforversion/12331360">https://issues.jboss.org/browse/HWKMETRICS/fixforversion/12331360</a></li>
</ul><p>A big "Thank you" goes to John Sanda, Matt Wringe, Michael Burman, Joel Takvorian, Jay Shaughnessy, Lucas Ponce, and Heiko Rupp for their project contributions.</p></p>
            <br />
            <hr /><br />
            <br />
            <a href="blog/2016/09/19/hawkular-apm-on-msa.html"><h1>Using Hawkular APM on Red Hat&apos;s Microservices Reference Architecture example</h1></a>
            <p>19 September 2016, by Juraci Paixão Kröhling</p>
            <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The focus of the <a href="https://github.com/hawkular/hawkular-apm/releases/tag/0.10.0.Final">latest Hawkular APM release</a>
has been in building a compatibility layer for ZipKin-aware applications. In this blog post, we&#8217;ll show how Hawkular APM can
be used as a drop-in replacement for ZipKin server and UI.</p>
</div>
<div class="paragraph">
<p>A video demonstrating this approach can also be viewed <a href="https://www.youtube.com/watch?v=USyGYVYlDIM">here</a>.</p>
</div>
<div class="paragraph">
<p>At the end of this blog post, we should see data flowing from the target applications to Hawkular APM, without any code changes
to the application themselves:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-09-19-screenshot3.png" alt="Hawkular APM Dashboard">
</div>
</div>
<div class="paragraph">
<p>Red Hat offers a <a href="http://developers.redhat.com/products/cdk/overview/">Container Developer Toolkit</a>, or CDK, for its customers,
allowing for a quick start on developing applications following the best practices on the microservices architecture.</p>
</div>
<div class="paragraph">
<p>Along with the CDK, Red Hat publishes also a <a href="https://github.com/redhat-helloworld-msa">"MSA - Hello World Microservices Architecture"</a>,
which demonstrates how applications might benefit from this architecture. It can also be used as seed for your own
projects, as it shows how activities can be accomplished by using several technology stacks, from <code>nodejs/express</code> to <code>Wildfly Swarm</code>.</p>
</div>
<div class="paragraph">
<p>For Hawkular APM, this offers a great way to test our APIs on different stacks, specially our ZipKin compatibility layer. Ideally,
one would simply point the ZipKin URL setting to a Hawkular APM server and everything would just work.</p>
</div>
<div class="paragraph">
<p>And that&#8217;s what we are going to do in this post!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started_with_cdk_and_msa">Getting started with CDK and MSA</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cdk_and_msa">CDK and MSA</h3>
<div class="paragraph">
<p>To setup CDK and MSA, we suggest that you follow the <a href="http://bit.ly/msainstructions">official instructions</a>. At the end of the process,
you should have all the services running. Open the "frontend" service, and click around a bit. For instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on the "Browser as client" menu item, which will make the browser make Ajax calls directly to the API endpoints</p>
</li>
<li>
<p>Click on the "API Gateway" menu item: on this case, the browser makes a single call to the API Gateway, which in turn makes single API calls
to each of the services</p>
</li>
<li>
<p>Click on "Service chaining" menu item: on this case, each service calls the "next", adding the results to its own payload.</p>
</li>
<li>
<p>It could be interesting to make a note about the hostnames, to later make sure that you have "new" Docker containers running.
The default output for each of the services include the hostname. Concretely, the output <code>ola-7-9wa31</code> means that the service <code>ola</code> is
running on the container with hostname <code>9wa31</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Open the ZipKin interface, and make sure that data is arriving there. Check also the different visualizations for the different operations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hawkular_apm">Hawkular APM</h3>
<div class="paragraph">
<p>We&#8217;ll use the <a href="http://www.hawkular.org/blog/2016/07/14/hawkular-apm-openshift.html">previous post on running Hawkular APM on OpenShift</a>
as base to install our Hawkular APM alongside the other MSA examples. For this blog post, we&#8217;ll prepare our own image based on the official
Dockerfile for Hawkular APM. For that, fork and clone <a href="https://github.com/jboss-dockerfiles/hawkular">our repository</a> and run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">cd hawkular-apm-server
oc new-app jboss/hawkular-apm-server
oc new-build --binary --name=hawkular-apm-server -l app=hawkular-apm-server
oc start-build hawkular-apm-server --from-dir=. --follow
oc expose service hawkular-apm-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, the image from Docker Hub can be used, although it&#8217;s possible that networking issues might occur. If you use this option and
the build takes more than, say, 10 minutes to finish, do a <code>vagrant ssh</code> to enter the box, and check the logs via <code>journalctl -f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">oc new-app jboss/hawkular-apm-server
oc expose service hawkular-apm-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should create a new image stream, build, deployment and application.</p>
</div>
<div class="paragraph">
<p>Before anything else, make note of the admin and password credentials. Those can be seen on the build logs:
Browse → Deployments → hawkular-apm-server → Click on the latest deployment → Logs.
A sample output is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>------------------------------------
ATTENTION ATTENTION ATTENTION ATTENTION
We automatically created an admin user for you to access the Hawkular APM web interface:
Username: adminQqyEF7i
Password: KS3mmZbkdhRZ5y7oF
------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this is done, there should be a new service available on OpenShift&#8217;s dashboard, with an URL like <code><a href="http://hawkular-apm-server-helloworld-msa.rhel-cdk.10.1.2.2.xip.io" class="bare">http://hawkular-apm-server-helloworld-msa.rhel-cdk.10.1.2.2.xip.io</a></code>.</p>
</div>
<div class="paragraph">
<p>Now that everything is in place and working as expected, it&#8217;s time to switch from ZipKin to Hawkular APM!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_making_the_switch">Making the switch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each one of the MSA modules has a <code>Dockerfile</code>, specifying a <code>ENV ZIPKIN_SERVER_URL <a href="http://zipkin-query:9411" class="bare">http://zipkin-query:9411</a></code>.
From there, we have some options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change each <code>Dockerfile</code> to make the env var point to <code><a href="http://hawkular-apm-server:8080" class="bare">http://hawkular-apm-server:8080</a></code></p>
</li>
<li>
<p>Specify the <code>-e</code> option to Docker, to override the <code>ZIPKIN_SERVER_URL</code></p>
</li>
<li>
<p>Set an Environment Variable in the OpenShift deployment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#8217;ll choose the last option, as we consider that as the less invasive one, inline with the Microservice idea that configuration should not
be a concern for the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">oc env dc/aloha       ZIPKIN_SERVER_URL="http://hawkular-apm-server:8080"
oc env dc/api-gateway ZIPKIN_SERVER_URL="http://hawkular-apm-server:8080"
oc env dc/bonjour     ZIPKIN_SERVER_URL="http://hawkular-apm-server:8080"
oc env dc/hola        ZIPKIN_SERVER_URL="http://hawkular-apm-server:8080"
oc env dc/ola         ZIPKIN_SERVER_URL="http://hawkular-apm-server:8080"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait a bit until OpenShift finishes deploying the new containers, and hit "Refresh Results" on the frontend. Note that the hostnames will change, indicating
that a new container is running. At around the same time, you should see the first data flowing to Hawkular APM.</p>
</div>
<div class="paragraph">
<p><strong>Spoiler alert</strong>: after the first two screenshots that we added for orientation, we also included some screenshots with the final result.</p>
</div>
<div class="sect2">
<h3 id="_overriding_the_environment_variable_on_an_openshift_deployment">Overriding the environment variable on an OpenShift deployment:</h3>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-09-19-screenshot7.png" alt="Environment variable in OpenShift deployment">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hawkular_apm_deployment_logs_on_openshift">Hawkular APM Deployment logs on OpenShift:</h3>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-09-19-screenshot6.png" alt="Deployment log">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sample_of_the_aggregated_visualization_for_the_service_chaining_technique">Sample of the aggregated visualization for the "Service chaining" technique:</h3>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-09-19-screenshot1.png" alt="Service chaining">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_details_about_a_single_instance_of_the_service_chaining_technique">Details about a single instance of the "Service chaining" technique:</h3>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-09-19-screenshot5.png" alt="Screenshot 5">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sample_of_the_aggregated_visualization_for_the_api_gateway_technique">Sample of the aggregated visualization for the "API Gateway" technique:</h3>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-09-19-screenshot2.png" alt="API Gateway">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_details_about_a_single_instance_of_the_api_gateway_technique">Details about a single instance of the "API Gateway" technique:</h3>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-09-19-screenshot4.png" alt="Screenshot 4">
</div>
</div>
</div>
</div>
</div></p>
            <br />
            <hr /><br />
            <br />
            <a href="blog/2016/09/14/consuming-hawkular-api-over-ssl.html"><h1>Consuming Hawkular API over SSL with self signed certificates</h1></a>
            <p>14 September 2016, by Josejulio Martínez</p>
            <p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this post I&#8217;ll show you how to trust self-signed certificates for use with Ruby client, used on projects such as ManageIQ and HawkFX.</p>
</div>
<div class="paragraph">
<p>If you haven&#8217;t already, follow this guide for
<a href="http://www.hawkular.org/hawkular-services/docs/installation-guide/secure-comm.html">securing communications</a> on your Hawkular server, because we&#8217;ll make use of the files generated by that guide.</p>
</div>
<div class="paragraph">
<p>As today, there are Hawkular clients for the following programming languages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/hawkular/hawkular-client-java">Java</a>.</p>
</li>
<li>
<p><a href="https://github.com/hawkular/hawkular-client-python">Python</a>.</p>
</li>
<li>
<p><a href="https://github.com/hawkular/hawkular-client-go">Go</a>.</p>
</li>
<li>
<p><a href="http://github.com/hawkular/hawkular-client-ruby">Ruby</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Hawkular Ruby client lets you connect using a secure connection. Buying a certificate from a trusted SSL vendor to host your own development server can be cost-prohibitive or just complicated.</p>
</div>
<div class="paragraph">
<p>If you are going to self-sign your own development certificates for use outside of Java, you will need to do some additional steps to tell your consumer environment to trust them.</p>
</div>
<div class="paragraph">
<p>For this you will need to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install <code>c_rehash</code>.</p>
</li>
<li>
<p>Identify where OpenSSL reads certificates and keys from.</p>
</li>
<li>
<p>Hand over your certificate to OpenSSL in PEM format and rehash.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_c_rehash">Install c_rehash</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>c_rehash</code> is an OpenSSL utility to create symbolic links to files by their hash values.
This format is used by OpenSSL to find certificates.</p>
</div>
<div class="paragraph">
<p>You can install it on fedora by executing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">$ sudo dnf install openssl-perl</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_identify_where_openssl_reads_certificates_and_keys_from">Identify where OpenSSL reads certificates and keys from.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenSSL reads certificates and keys from a specific path, you will need to copy your self-signed certificates there.
You can find this path by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">$ openssl version -d
OPENSSLDIR: "/etc/pki/tls"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, OpenSSL files are located in <code>/etc/pki/tls</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The above output is from Fedora 24, it should be similar on other operative systems.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
It seems that if you are using RVM to manage your Ruby versions, you should ignore this
and use: $rvm_path/usr/ssl
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hand_over_your_certificate_to_openssl_in_pem_format_and_rehash">Hand over your certificate to OpenSSL in PEM format and rehash.</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>c_rehash</code> specs the certificates in PEM format, so before proceeding we need make sure is in PEM format. The <a href="http://www.hawkular.org/hawkular-services/docs/installation-guide/secure-comm.html">guide</a> for securing communications on Hawkular produces the certificate in DER format it needs to be converted to PEM format.</p>
</div>
<div class="paragraph">
<p>OpenSSL can be used as follow to convert <code>hawkular.cert</code> from DER to PEM format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">$ openssl x509 -inform der -in hawkular.cert -out hawkular.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once created, copy your PEM certificate to <code>OPENSSLDIR/certs</code> (you will need root permissions) and run c_rehash on that dir.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">$ sudo cp hawkular.pem OPENSSLDIR/certs
$ sudo c_rehash OPENSSLDIR/certs</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using any application that relies on JRuby (such as HawkFX) you will probably need to use old-style hashes. To do that run c_rehash a second time with flags to use the old-style hash and to keep existing hashes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">$ sudo c_rehash -old -n OPENSSLDIR/certs</code></pre>
</div>
</div>
<div class="paragraph">
<p>That should be enough to let Ruby client or any application that uses it (e.g. HawkFX) to communicate with Hawkular Server over SSL.</p>
</div>
<div class="paragraph">
<p>To use on HawkFX simply put the address with https and the secure port.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-09-14-hawkfx-over-https.png" alt="HawkFX over https">
</div>
</div>
</div>
</div></p>
            <br />
            <hr /><br />
            <br />



    <div class="large-4 columns blog-post-listings">
        <h2>Older posts:</h2>
        <ul>
          <li>05 September 2016 - <a href="blog/2016/09/05/hawkular-metrics-0.19.0.Final-released.html">Hawkular Metrics 0.19.0 - Release</a></li>
          <li>31 August 2016 - <a href="blog/2016/08/31/spark-metric-analysis.html">Metric Data Analysis using the Apache Spark</a></li>
          <li>11 August 2016 - <a href="blog/2016/08/11/vertx-agent-inventory-impl.html">Vert.x agent inventory implementation</a></li>
          <li>01 August 2016 - <a href="blog/2016/08/01/hawkular-metrics-0.18.0.Final-released.html">Hawkular Metrics 0.18.0 - Release</a></li>
          <li>19 July 2016 - <a href="blog/2016/07/19/android-client-progess.html">What is new in Android Client</a></li>
          <li>14 July 2016 - <a href="blog/2016/07/14/hawkular-apm-openshift.html">Monitoring Application Performance within Openshift</a></li>
          <li>14 July 2016 - <a href="blog/2016/07/14/hawkular-miq.html">Getting started with ManageIQ and Hawkular</a></li>
          <li>13 July 2016 - <a href="blog/2016/07/13/hawkfx.html">Introducing HawkFX</a></li>
          <li>12 July 2016 - <a href="blog/2016/07/12/hawkular-and-jmx-jolokia.html">Hawkular and JMX/Jolokia</a></li>
          <li>12 July 2016 - <a href="blog/2016/07/12/hawkular-and-prometheus.html">Hawkular and Prometheus</a></li>
          <li>06 July 2016 - <a href="blog/2016/07/06/hawkular-metrics-0.17.0.Final-released.html">Hawkular Metrics 0.17.0 - Release</a></li>
          <li>05 July 2016 - <a href="blog/2016/07/05/hawkular-services-0.0.5.Final.html">Hawkular Services 0.0.5.Final</a></li>
          <li>05 July 2016 - <a href="blog/2016/07/05/scaling-hawkular-alerting.html">Scaling stateful services: an example in Hawkular Alerting</a></li>
          <li>27 June 2016 - <a href="blog/2016/06/27/hawkular-apm-0.9-released.html">Hawkular APM 0.9.0.Final Released</a></li>
          <li>14 June 2016 - <a href="blog/2016/06/14/hawkular-services-0.0.2.Final.html">Hawkular Services 0.0.2.Final</a></li>
          <li>01 June 2016 - <a href="blog/2016/06/01/hawkular-btm-to-apm.html">Hawkular BTM component rename</a></li>
          <li>01 June 2016 - <a href="blog/2016/06/01/hawkular-metrics-0.16.0.Final-released.html">Hawkular Metrics 0.16.0 - Release</a></li>
          <li>26 May 2016 - <a href="blog/2016/05/26/hawkular-btm-booker-demo.html">Monitoring Microservices for Application Performance, Distributed Tracing and Business Transactions</a></li>
          <li>24 May 2016 - <a href="blog/2016/05/24/hawkular-btm-ticketmonster-demo.html">Obtaining business metrics without the need to instrument your application</a></li>
          <li>02 May 2016 - <a href="blog/2016/05/02/hawkular-metrics-0.15.0.Final-released.html">Hawkular Metrics 0.15.0 - Release</a></li>
          <li>28 April 2016 - <a href="blog/2016/04/28/new-packaging.html">New Hawkular packaging</a></li>
          <li>27 April 2016 - <a href="blog/2016/04/27/hawkular-inventory-0.15.0.Final-released.html">Hawkular Inventory 0.15.0.Final - Release</a></li>
          <li>22 April 2016 - <a href="blog/2016/04/22/collecting-metrics-from-prometheus-endpoints.html">Collecting Metrics from Prometheus Endpoints</a></li>
          <li>21 April 2016 - <a href="blog/2016/04/21/datamining-first-release.html">Hawkular Data Mining 0.1.0.Final Released</a></li>
          <li>19 April 2016 - <a href="blog/2016/04/19/jmxtrans-to-hawkular-metrics.html">Monitoring JVM applications with jmxtrans</a></li>
          <li>08 April 2016 - <a href="blog/2016/04/08/hawkular-manage-iq-sprint-demo.html">Hawkular in ManageIQ sprint demo(s)</a></li>
          <li>29 March 2016 - <a href="blog/2016/03/29/hawkular-metrics-0.14.0.Final-released.html">Hawkular Metrics 0.14.0 - Release</a></li>
          <li>21 March 2016 - <a href="blog/2016/03/20/qr-android.html">QR Code support for Android Client</a></li>
          <li>16 March 2016 - <a href="blog/2016/03/16/hawkular-metrics-roadmap.html">Hawkular Metrics - Roadmap</a></li>
          <li>15 March 2016 - <a href="blog/2016/03/15/hawkular-1.0.0.Alpha11-released.html">The eleventh milestone of Hawkular released</a></li>
          <li>02 March 2016 - <a href="blog/2016/03/02/hawkular-metrics-0.13.0.Final-released.html">Hawkular Metrics 0.13.0 - Release</a></li>
          <li>23 February 2016 - <a href="blog/2016/02/22/hawkular-manage-iq.html">Integration with ManageIQ</a></li>
          <li>02 February 2016 - <a href="blog/2016/02/02/hawkular-metrics-0.12.0.Final-released.html">Hawkular Metrics 0.12.0 - Release</a></li>
          <li>25 January 2016 - <a href="blog/2016/01/25/hawkular-btm-apm.html">Hawkular-BTM now includes Application Performance Management</a></li>
          <li>21 January 2016 - <a href="blog/2016/01/21/hawkular-1.0.0.Alpha9-released.html">The nineth milestone of Hawkular released</a></li>
          <li>21 January 2016 - <a href="blog/2016/01/21/hawkular-command-gateway-clients.html">Hawkular Command Gateway Clients</a></li>
          <li>20 January 2016 - <a href="blog/2016/01/20/hawkular-datamining-demo-hwk-alpha9.html">Hawkular Data Mining - Predictive Charts</a></li>
          <li>12 January 2016 - <a href="blog/2016/01/12/hawkular-metrics-0.11.0.Final-released.html">Hawkular Metrics 0.11.0 - Release</a></li>
          <li>05 January 2016 - <a href="blog/2016/01/05/we-are-hiring.html">We are hiring !</a></li>
          <li>16 December 2015 - <a href="blog/2015/12/16/hawkular-1.0.0.Alpha8-released.html">The eigth milestone of Hawkular released</a></li>
          <li>01 December 2015 - <a href="blog/2015/12/01/hawkular-btm-instrument-docker-image.html">BTM: Instrumenting an application running from a docker image</a></li>
          <li>30 November 2015 - <a href="blog/2015/11/30/hawkular-btm-0-6-0-released.html">Monitoring Business Transactions in JBoss Ticket Monster App (Part 2)</a></li>
          <li>19 November 2015 - <a href="blog/2015/11/19/hawkular-1.0.0.Alpha7-released.html">Yet another release of Hawkular, the seventh one !</a></li>
          <li>10 November 2015 - <a href="blog/2015/11/10/hawkular-btm-0-5-0-released.html">Monitoring Business Transactions in JBoss Ticket Monster App</a></li>
          <li>30 October 2015 - <a href="blog/2015/10/30/hawkular-metrics-0.8.0.Final-released.html">Hawkular Metrics 0.9.0 - Release</a></li>
          <li>30 October 2015 - <a href="blog/2015/11/30/hawkular-metrics-0.10.0.Final-released.html">Hawkular Metrics 0.10.0 - Release</a></li>
          <li>24 October 2015 - <a href="blog/2015/10/24/hawkular-datamining.html">Introduction to Hawkular Data Mining Module</a></li>
          <li>21 October 2015 - <a href="blog/2015/10/21/hawkular-1.0.0.Alpha6-released.html">The sixth milestone of Hawkular released</a></li>
          <li>12 October 2015 - <a href="blog/2015/10/12/hawkular-metrics-0.8.0.Final-released.html">Hawkular Metrics 0.8.0 - Release</a></li>
          <li>09 October 2015 - <a href="blog/2015/10/09/graph-db-performance.html">Titan Graph DB Performance Tips</a></li>
          <li>06 October 2015 - <a href="blog/2015/10/06/hawkular-btm-0-4-0-released.html">Hawkular-BTM 0.4.0 released</a></li>
          <li>05 October 2015 - <a href="blog/2015/10/05/hawkular-metrics-2k-commits.html">Hawkular Metrics - 2k Commits</a></li>
          <li>30 September 2015 - <a href="blog/2015/09/30/hawkular-metrics-0.7.0.Final-released.html">Hawkular Metrics 0.7.0 - Release</a></li>
          <li>23 September 2015 - <a href="blog/2015/09/23/hawkular-1.0.0.Alpha5-released.html">The fifth milestone of Hawkular released</a></li>
          <li>03 September 2015 - <a href="blog/2015/09/03/monitoring-rails-using-hawkular-metrics.html">Monitoring Rails App using Hawkular Metrics</a></li>
          <li>29 August 2015 - <a href="blog/2015/08/29/hawkular-metrics-0.6.0.Final-released.html">Hawkular Metrics 0.6.0 - Release</a></li>
          <li>27 August 2015 - <a href="blog/2015/08/27/hawkular-1.0.0.Alpha4-released.html">The fourth milestone of Hawkular released</a></li>
          <li>25 August 2015 - <a href="blog/2015/08/25/hawkular-alerts-autoresolve.html">Introduction to AutoResolve triggers</a></li>
          <li>19 August 2015 - <a href="blog/2015/08/19/hawkular-alerts-standalone.html">Using Hawkular Alerts as a standalone engine</a></li>
          <li>14 August 2015 - <a href="blog/2015/08/14/hawkular-btm-0.3.0-demo.html">Visualising Business Transaction Information using Hawkular BTM 0.3.0.Final with RTGov Integration</a></li>
          <li>30 July 2015 - <a href="blog/2015/07/30/hawkular-1.0.0.Alpha3-released.html">Hawkular, all good things make three!</a></li>
          <li>22 July 2015 - <a href="blog/2015/07/22/hawkular-btm-0.2.0-demo.html">Monitoring a Vert.x Application using Hawkular BTM 0.2.0.Final</a></li>
          <li>02 July 2015 - <a href="blog/2015/07/02/hawkular-1.0.0.Alpha2-released.html">Hawkular, the second release!</a></li>
          <li>01 July 2015 - <a href="blog/2015/07/01/hawkular-btm-0-1-0-released.html">Hawkular-BTM 0.1.0 released</a></li>
          <li>01 July 2015 - <a href="blog/2015/07/01/hawkular-btm-0.1.0-demo.html">Monitoring a SwitchYard Application using Hawkular BTM 0.1.0.Final</a></li>
          <li>22 June 2015 - <a href="blog/2015/06/23/hawkular-metrics-0-4-0-released.html">Hawkular Metrics 0.4.0 - Release</a></li>
          <li>17 June 2015 - <a href="blog/2015/06/17/marsjug-and-rivieradev-retrospective.html">MarsJUG and RivieraDEV retrospective</a></li>
          <li>04 June 2015 - <a href="blog/2015/06/04/hawkular-1.0.0.Alpha1-released.html">Hawkular, the first release!</a></li>
          <li>01 June 2015 - <a href="blog/2015/06/01/hawkular-metrics-0-3-4-released.html">Hawkular Metrics 0.3.4 - Release</a></li>
          <li>30 April 2015 - <a href="blog/2015/04/30/introducing-btm.html">Introducing the latest Hawkular component: Business Transaction Management</a></li>
          <li>29 April 2015 - <a href="blog/2015/04/29/hello-to-gsoc-students.html">Hello GSoC Students</a></li>
          <li>17 April 2015 - <a href="blog/2015/04/14/intro-to-hawkular.html">Intro to Hawkular, a middleware open-source management solution</a></li>
          <li>14 April 2015 - <a href="blog/2015/04/14/hawkular-monitor-agent-intro.html">Hawkular-Monitor Agent</a></li>
          <li>09 April 2015 - <a href="blog/2015/04/09/alert-notifiers-for-mobile-devices.html">Alert notifiers for mobile devices</a></li>
          <li>08 April 2015 - <a href="blog/2015/2015-04-08-1.html">Testing collectd integration</a></li>
          <li>07 April 2015 - <a href="blog/2015/2015-04-07-1.html">Hawkular Metrics 0.3.1 - Release</a></li>
          <li>01 April 2015 - <a href="blog/2015/2015-04-01-1.html">Hawkular Discontinued</a></li>
          <li>30 March 2015 - <a href="blog/2015/2015-03-30-1.html">Dockerized Hawkular builds available</a></li>
          <li>24 February 2015 - <a href="blog/2015/2015-02-24-1.html">The Kettle starts boiling</a></li>
          <li>16 February 2015 - <a href="blog/2015/2015-02-16-1.html">Hawkular Metrics 0.2.7 - Release</a></li>
        <br/><br/>
    </div>

    <a href=feed.xml><i class="fa fa-rss"></i> RSS Feed</a>
</div>


		</div>
		<div id="push"></div>
    </div>

    <section class="redhat clearfix">
      <div class="container">
        <p class="pull-left">
          <a href="http://www.redhat.com/">
            <img alt="redhatlogo-white" src="/img/redhatlogo-white.png" width="130">
          </a>
        </p>
        <p class="muted credit pull-right">
				  &copy; 2016 | Hawkular is released under <a href="/license.html">Apache License v2.0</a>
					<a href="https://twitter.com/hawkular_org" class="twitter-follow-button" data-show-count="false" data-size="medium">Follow @hawkular_org</a>
				  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
				</p>

    <!--p id="forkongithubp"><span id="forkongithub">
      <a href="https://github.com/hawkular" class="bg-grey">
        Fork me on GitHub
      </a>
    </span></p-->
      </div>
    </section>

    <!-- javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- js -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="js/jbossorg-tabzilla.js"></script>
    <script src="js/behavior.js"></script>
    <script src="js/prettify.js"></script>
    <script src="js//ekko-lightbox.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'hawkular';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61728352-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
